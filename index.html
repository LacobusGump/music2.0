<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta
  name="viewport"
  content="width=device-width,initial-scale=1.0"
/>
<title>Life Soundtrack: Adaptive Music Evolution</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
<!-- ——— styles trimmed for brevity; they’re identical to what you posted ——– -->
<style>
/* … keep all your CSS exactly as in your last message … */
</style>
</head>

<body>
  <!-- ✂ (all your HTML markup: container, HUD, motion grid, etc.) ✂ -->
  <!-- — everything through <div class="picardy-surge" id="picardySurge"></div> — -->
  <!-- (unchanged from your last paste) -->

<script>
/* ---------------------------------------------------------------------------
 * 1.  GLOBAL MUSICAL CONSTANTS  (unchanged)
 * ------------------------------------------------------------------------- */
const MUSICAL_SYSTEM = {/* … as in your code … */};

/* ---------------------------------------------------------------------------
 * 2.  GLOBAL STATE
 * ------------------------------------------------------------------------- */
const state = {/* … as in your code … */};

/* ---------------------------------------------------------------------------
 * 3.  AUDIO SET-UP
 * ------------------------------------------------------------------------- */
let instruments = {};
let effects     = {};
let master, analyser;

/* initialise audio graph -------------------------------------------------- */
async function initAudio() {
  if (state.audioInitialized) return;
  await Tone.start();

  /* —— instruments ——————————————————————————— */
  instruments.ambient = new Tone.PolySynth(Tone.Synth,{oscillator:{type:'sine'},
      envelope:{attack:3,decay:2,sustain:0.8,release:4}});
  instruments.bass    = new Tone.MonoSynth({oscillator:{type:'sawtooth'},
      envelope:{attack:0.1,decay:0.3,sustain:0.4,release:0.8}});
  instruments.drums   = new Tone.MembraneSynth({pitchDecay:0.05,octaves:10,
      envelope:{attack:0.001,decay:0.4,sustain:0.01,release:1.4}});
  instruments.harmony = new Tone.PolySynth(Tone.Synth,{oscillator:{type:'triangle'},
      envelope:{attack:0.5,decay:0.8,sustain:0.6,rele
