<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GUMP: Grand Unified Music Project</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html,body { height:100%; margin:0; background:#070a11; overflow:hidden;}
    body { font-family: -apple-system, BlinkMacSystemFont, sans-serif;}
    .intro { position:fixed; top:0; left:0; width:100vw; height:100vh; background:radial-gradient(ellipse at 60% 50%,#181e2f 0%,#070a11 80%); display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:20; transition:opacity 1.1s;}
    .intro-title { font-size:2.5rem; font-weight:900; letter-spacing:2px; color:#e5f8ff; text-shadow:0 0 60px #7fdaff,0 4px 16px #000b; margin-bottom:2.2rem; opacity:.95; animation:introFade 2.7s cubic-bezier(.9,0,.1,1) alternate infinite;}
    .intro-author { font-size:1.14rem; color:#b3e3f9; opacity:.84; margin-bottom:2.6rem; letter-spacing:.7px;}
    .intro-btn { background:linear-gradient(85deg,#00cfff 25%,#ed9fe7 90%); color:#111; font-weight:700; font-size:1.15rem; padding:19px 52px; border-radius:40px; border:none; cursor:pointer; box-shadow:0 0 36px #59d4fd22; letter-spacing:1px; transition:transform 0.16s;}
    .intro-btn:active { transform:scale(0.98);}
    @keyframes introFade { from { text-shadow:0 0 16px #b2fff7; } to { text-shadow:0 0 68px #fff9,0 4px 20px #b4d7ff88;} }
    .app {position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:1;opacity:0;transition:opacity 1.3s;}
    .orb-viz { width:78vw; max-width:340px; height:78vw; max-height:340px; margin:0 auto; position:relative; top:8vh; border-radius:50%; background:radial-gradient(circle at 44% 50%,#222a44 12%,#070a11 90%); box-shadow:0 0 100px 10px #4ecdc433,0 0 130px #02122e88 inset; border:2.2px solid #3e579c40; display:flex; align-items:center; justify-content:center; transition:all 2.5s cubic-bezier(0.4,0,0.2,1);}
    .orb-viz.void { background:radial-gradient(circle at 44% 50%,#392644 12%,#18101a 90%); box-shadow:0 0 180px 30px #6e3c7e44,0 0 180px #2e1222aa inset; border:2.5px solid #ad8cbe80;}
    .music-orb { position:absolute; width:92px; height:92px; left:50%; top:50%; transform:translate(-50%,-50%); background:radial-gradient(circle at 58% 41%,#18182c 0%,#b4cfff45 70%,#2c222a 100%); border-radius:50%; box-shadow:0 0 80px #b5a8fa38,0 0 30px #b9fff866; z-index:2; transition:all 2.8s cubic-bezier(0.25,0.8,0.25,1); animation:orbPulse 5.3s cubic-bezier(.65,0,.35,1) infinite alternate;}
    .music-orb.void { background:radial-gradient(circle at 52% 46%,#fff2ee 7%,#d0bdfc 25%,#cfdefc 90%); box-shadow:0 0 140px #edbcff59,0 0 120px #fff8,0 0 230px #ff9fdd33; animation:voidPulse 6.2s cubic-bezier(.4,0,.6,1) infinite alternate; transform:translate(-50%,-50%) scale(1.08);}
    .orb-glow { position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:250px; height:250px; border-radius:50%; z-index:1; background:radial-gradient(circle at 52% 48%,#6eacf933 1%,#bdf2ffa0 30%,#0b0f1800 98%); pointer-events:none; mix-blend-mode:lighten; opacity:.79; filter:blur(9px); transition:all 2.5s cubic-bezier(0.4,0,0.2,1); animation:orbPulse 4.6s cubic-bezier(.65,0,.35,1) infinite alternate;}
    .orb-glow.void { background:radial-gradient(circle at 52% 48%,#cfb0ff40 1%,#eedcfbaa 30%,#1a0f1600 98%); width:340px; height:340px; filter:blur(17px); animation:voidGlow 7.1s cubic-bezier(.3,0,.7,1) infinite alternate;}
    @keyframes orbPulse {from{opacity:.72;}to{opacity:.92;}}
    @keyframes voidPulse {from{opacity:.82;transform:translate(-50%,-50%) scale(1.07);}to{opacity:.95;transform:translate(-50%,-50%) scale(1.13);}}
    @keyframes voidGlow {from{opacity:.7;}to{opacity:1;}}
    .world-label { position:absolute; left:50%; top:94%; transform:translate(-50%,-50%); background:rgba(17,24,31,0.90); color:#e5f8ff; padding:10px 26px; border-radius:30px; font-size:1.1rem; letter-spacing:.5px; font-weight:600; opacity:0; pointer-events:none; box-shadow:0 8px 30px #0b0f1b2a; transition:all 0.8s cubic-bezier(0.4,0,0.2,1); z-index:10; text-align:center;}
    .world-label.show { opacity:1; transform:translate(-50%,-50%) scale(1.02);}
    .world-label.void { background:rgba(42,24,41,0.93); color:#f9e5ff; box-shadow:0 8px 40px #3d1b3b44;}
    .label-floatin { animation: labelFloatIn 0.8s cubic-bezier(.8,0,.4,1);}
    @keyframes labelFloatIn { from { opacity:0; transform:translate(-50%,20px); } to{ opacity:1; transform:translate(-50%,-50%);} }
    @media (max-width:500px) {
      .intro-title{font-size:1.2rem;}
      .world-label{font-size:.97rem;}
      .orb-viz{top:2vh;}
    }
  </style>
</head>
<body>
  <div class="intro" id="intro">
    <div class="intro-title">GUMP: Grand Unified Music Project</div>
    <div class="intro-author">By James McCandless</div>
    <button class="intro-btn" id="begin">Begin</button>
  </div>
  <div class="app" id="app">
    <div class="orb-viz" id="orbViz">
      <div class="orb-glow" id="orbGlow"></div>
      <div class="music-orb" id="orb"></div>
      <div class="world-label" id="worldLabel"></div>
    </div>
  </div>
  <script>
    // Core GUMP v2
    let ctx = null, audio = null, allowMotion = false, orbEl, orbVizEl, orbGlowEl, labelEl;
    let currentLayers = [], voidLayers = [], songDNA = {}, world = { weather:"Clear", hour:12, day:"Monday", city:"Nowhere" };
    let moving = false, voidMode = false, lastMove = 0, mainGain, voidGain;

    window.onload = ()=>{
      orbEl = document.getElementById('orb');
      orbVizEl = document.getElementById('orbViz');
      orbGlowEl = document.getElementById('orbGlow');
      labelEl = document.getElementById('worldLabel');
      document.getElementById('begin').onclick = startGUMP;
    };

    function fadeOut(el, ms=900){el.style.transition=`opacity ${ms}ms`;el.style.opacity=0;}
    function fadeIn(el, ms=900){el.style.transition=`opacity ${ms}ms`;el.style.opacity=1;}
    function showLabel(msg, time=1200) {
      labelEl.textContent = msg;
      labelEl.classList.add('show','label-floatin');
      setTimeout(()=>labelEl.classList.remove('label-floatin'),600);
      if(time) setTimeout(()=>labelEl.classList.remove('show'),time);
    }

    async function startGUMP() {
      fadeOut(document.getElementById('intro'),900);
      setTimeout(()=>{
        document.getElementById('intro').style.display='none';
        document.getElementById('app').style.opacity=1;
        beginPermissions();
      },900);
    }

    async function beginPermissions(){
      ctx = audio = new (window.AudioContext || window.webkitAudioContext)();
      await ctx.resume();
      // MOTION
      if(window.DeviceMotionEvent && typeof DeviceMotionEvent.requestPermission==="function") {
        try { let r = await DeviceMotionEvent.requestPermission(); if(r==="granted") allowMotion=true; }catch{}
      } else allowMotion=true;
      runStartupSequence();
    }

    function runStartupSequence(){
      // System boot: "crank" noises, quick pulses, then each layer joins
      orbEl.style.opacity = 0.7; orbEl.style.transform = "translate(-50%,-50%) scale(0.91)";
      songDNA = makeSongDNA();
      let steps = [
        { label:"Cranking Up Engineâ€¦", fn: musicCrank },
        { label:"Weather Detected: "+songDNA.weather, fn: ()=>musicLayer_pad(songDNA) },
        { label:"Time Synced: "+songDNA.timeName, fn: ()=>musicLayer_bass(songDNA) },
        { label:"Day/Week: "+songDNA.day, fn: ()=>musicLayer_perc(songDNA) },
        { label:"Location: "+songDNA.city, fn: ()=>musicLayer_motif(songDNA) }
      ];
      let i=0;
      function nextLayer(){
        if(i<steps.length){
          showLabel(steps[i].label,1060+140*i);
          steps[i].fn();
          orbEl.style.transform = `translate(-50%,-50%) scale(${0.91+0.03*i})`;
          setTimeout(nextLayer,1160+110*i);
          i++;
        } else {
          setTimeout(()=>{
            showLabel("Ready! Move to build your song.",1400);
            orbEl.style.transform = "translate(-50%,-50%) scale(1.06)";
            startupReady();
          },800);
        }
      }
      setTimeout(nextLayer, 600);
    }

    function makeSongDNA(){
      // "Orchestra seating": always a unique session
      let dt = new Date();
      let hour = dt.getHours(), day = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][dt.getDay()];
      let timeName = (hour<6)?"Night":(hour<12)?"Morning":(hour<18)?"Afternoon":"Evening";
      let weather = ["Clear","Cloudy","Rain","Fog","Snow"][Math.floor(Math.random()*5)];
      let city = "Jersey";
      // Harmonies always musical: Dorian or minor pentatonic, but root varies by time
      let roots = [220, 247, 262, 294, 330, 349, 392, 440];
      let basePitch = roots[(hour+dt.getDate())%roots.length];
      let scale = (weather==="Clear"||weather==="Snow") ?
        [0,2,3,5,7,9,10,12] : [0,3,5,7,10,12];
      return { basePitch, scale, weather, hour, timeName, day, city };
    }

    // ========== CRANK ENGINE ==========
    function musicCrank(){
      // Startup: mechanical pulses, noise bursts, then "engine starts"
      for(let k=0;k<5;k++){
        setTimeout(()=>{
          let o = audio.createOscillator(), g = audio.createGain();
          o.type="square"; o.frequency.value=rand(180,400);
          g.gain.value=0.06 + 0.10*(k/5);
          o.connect(g).connect(audio.destination);
          o.start(); o.stop(audio.currentTime+0.16+0.06*k);
          g.gain.linearRampToValueAtTime(0.0001, audio.currentTime+0.16+0.06*k);
        },90*k);
      }
      // Low rumble after
      setTimeout(()=>{
        let o = audio.createOscillator(), g = audio.createGain();
        o.type="triangle"; o.frequency.value=rand(42,52);
        g.gain.value=0.11;
        o.connect(g).connect(audio.destination);
        o.start(); o.stop(audio.currentTime+1.0);
        g.gain.linearRampToValueAtTime(0.0001, audio.currentTime+1.0);
      }, 500);
    }
    // ========== PADS ==========
    function musicLayer_pad(dna){
      // Weather = pad color and brightness
      let freq = dna.basePitch*Math.pow(2, dna.scale[2]/12);
      let type = dna.weather==="Fog"||dna.weather==="Rain"?"triangle":"sine";
      let len = 2.6, vol = dna.weather==="Clear"?0.13:0.18;
      let o = audio.createOscillator(), g = audio.createGain();
      o.type=type; o.frequency.value=freq;
      g.gain.setValueAtTime(vol,audio.currentTime);
      g.gain.linearRampToValueAtTime(0.0001,audio.currentTime+len);
      o.connect(g).connect(audio.destination);
      o.start(); o.stop(audio.currentTime+len);
      currentLayers.push({o,g});
      // Add shimmer on snow
      if(dna.weather==="Snow") {
        let o2 = audio.createOscillator(), g2 = audio.createGain();
        o2.type="triangle"; o2.frequency.value=freq*2.9;
        g2.gain.value=0.10;
        o2.connect(g2).connect(audio.destination);
        o2.start(); o2.stop(audio.currentTime+1.1);
        g2.gain.linearRampToValueAtTime(0.0001,audio.currentTime+1.1);
        currentLayers.push({o:o2,g:g2});
      }
    }
    // ========== BASS ==========
    function musicLayer_bass(dna){
      let freq = dna.basePitch*Math.pow(2,dna.scale[0]/12)*0.5;
      let o = audio.createOscillator(), g = audio.createGain();
      o.type="triangle"; o.frequency.value=freq;
      g.gain.value=0.16;
      o.connect(g).connect(audio.destination);
      o.start(); o.stop(audio.currentTime+2.1);
      g.gain.linearRampToValueAtTime(0.0001,audio.currentTime+2.1);
      currentLayers.push({o,g});
    }
    // ========== PERC ==========
    function musicLayer_perc(dna){
      let percs = [rand(0.3,1.2), rand(0.8,2.1), rand(1.4,2.5)];
      percs.forEach((dly,idx)=>{
        setTimeout(()=>{
          let o = audio.createOscillator(), g = audio.createGain();
          o.type="square"; o.frequency.value=rand(340,620-idx*140);
          g.gain.value=0.10+0.05*idx;
          o.connect(g).connect(audio.destination);
          o.start(); o.stop(audio.currentTime+0.08+0.05*idx);
          g.gain.linearRampToValueAtTime(0.0001, audio.currentTime+0.08+0.05*idx);
        },dly*450);
      });
    }
    // ========== MOTIF ==========
    function musicLayer_motif(dna){
      let motif = [0,2,4,3,1,0].map(i=>dna.basePitch*Math.pow(2,dna.scale[i%dna.scale.length]/12));
      motif.forEach((f,idx)=>{
        setTimeout(()=>{
          let o = audio.createOscillator(), g = audio.createGain();
          o.type=idx%2==0?"triangle":"sine"; o.frequency.value=f;
          g.gain.value=0.09+0.01*idx;
          o.connect(g).connect(audio.destination);
          o.start(); o.stop(audio.currentTime+0.19+0.01*idx);
          g.gain.linearRampToValueAtTime(0.0001, audio.currentTime+0.19+0.01*idx);
        },220*idx+160);
      });
    }
    // ========== MAIN LOOP ==========
    function startupReady(){
      // MOTION TRACKING
      if(allowMotion){
        window.addEventListener('devicemotion',e=>{
          let acc = e.accelerationIncludingGravity;
          let lv = acc ? Math.sqrt(acc.x*acc.x+acc.y*acc.y+acc.z*acc.z) : 0;
          moving = lv>13;
          if(moving) lastMove = Date.now();
        });
      }
      runSongLoop();
    }
    // ========== SONG LOOP ==========
    function runSongLoop(){
      setInterval(()=>{
        let idle = (!moving && Date.now()-lastMove>1600);
        if(idle!==voidMode){
          voidMode = idle;
          orbVizEl.classList.toggle('void',voidMode);
          orbEl.classList.toggle('void',voidMode);
          orbGlowEl.classList.toggle('void',voidMode);
          labelEl.classList.toggle('void',voidMode);
          showLabel(voidMode?"Heaven":"Back to World",1200);
          if(voidMode){ crossfadeToVoid(); } else { crossfadeToWorld(); }
        }
        if(voidMode){
          playVoidSymphony();
        } else if(moving){
          buildSymphony(songDNA);
        }
      }, 380);
    }
    // ========== BUILD SYMPHONY ==========
    function buildSymphony(dna){
      // Additive layers (keeps stacking but clears if too much)
      if(currentLayers.length>24) currentLayers.splice(0,7);
      // Drums
      if(Math.random()>0.7) {
        let o = audio.createOscillator(), g = audio.createGain();
        o.type="sine"; o.frequency.setValueAtTime(56,audio.currentTime);
        o.frequency.exponentialRampToValueAtTime(34,audio.currentTime+0.12);
        g.gain.value=0.25;
        o.connect(g).connect(audio.destination);
        o.start(); o.stop(audio.currentTime+0.19);
        g.gain.linearRampToValueAtTime(0.0001,audio.currentTime+0.19);
        currentLayers.push({o,g});
      }
      // Pads that evolve based on weather
      if(Math.random()>0.82){
        let pad = audio.createOscillator(), gain = audio.createGain();
        pad.type = dna.weather=="Clear"?"triangle":"sine";
        pad.frequency.value = dna.basePitch*Math.pow(2,dna.scale[Math.floor(Math.random()*dna.scale.length)]/12);
        gain.gain.value = 0.13+Math.random()*0.08;
        pad.connect(gain).connect(audio.destination);
        pad.start();
        pad.stop(audio.currentTime+1.6+Math.random()*1.6);
        gain.gain.linearRampToValueAtTime(0.0001,audio.currentTime+1.4+Math.random()*1.6);
        currentLayers.push({o:pad,g:gain});
      }
      // Sparkle/Bells on sunny/void
      if(dna.weather=="Clear" && Math.random()>0.89){
        let bell = audio.createOscillator(), g = audio.createGain();
        bell.type="sine"; bell.frequency.value = dna.basePitch*2.74+rand(-6,8);
        g.gain.value = 0.10; bell.connect(g).connect(audio.destination);
        bell.start(); bell.stop(audio.currentTime+0.5+Math.random()*0.5);
        g.gain.linearRampToValueAtTime(0.0001,audio.currentTime+0.49+Math.random()*0.5);
        currentLayers.push({o:bell,g});
      }
      // Occasional city motif
      if(Math.random()>0.91){
        let o = audio.createOscillator(), g = audio.createGain();
        o.type="triangle"; o.frequency.value = dna.basePitch*Math.pow(2,dna.scale[2]/12) + rand(-8,10);
        g.gain.value = 0.09; o.connect(g).connect(audio.destination);
        o.start(); o.stop(audio.currentTime+0.33+Math.random()*0.12);
        g.gain.linearRampToValueAtTime(0.0001,audio.currentTime+0.31+Math.random()*0.11);
        currentLayers.push({o,g});
      }
    }
    // ========== VOID WORLD ==========
    function crossfadeToVoid(){
      // Fade out all main sounds, let void layers dominate
      currentLayers.forEach(l=>{
        try{l.g.gain.linearRampToValueAtTime(0.0001,audio.currentTime+1.1);}catch{}
        try{l.o.stop(audio.currentTime+1.14);}catch{}
      });
      currentLayers=[];
      // Optional: fade background to void
    }
    function crossfadeToWorld(){
      voidLayers.forEach(l=>{
        try{l.g.gain.linearRampToValueAtTime(0.0001,audio.currentTime+1.2);}catch{}
        try{l.o.stop(audio.currentTime+1.19);}catch{}
      });
      voidLayers=[];
    }
    function playVoidSymphony(){
      // Dark, glimmering, ethereal harmony, never static
      if(voidLayers.length>12) voidLayers.splice(0,7);
      let freq = songDNA.basePitch * (Math.random()>0.75? 1.41 : 0.71) * (1+rand(-.04,.04));
      let type = Math.random()>0.55?"triangle":"sine";
      let len = rand(2.7,4.4), vol = 0.14+rand(0,0.11);
      let o = audio.createOscillator(), g = audio.createGain();
      o.type=type; o.frequency.value=freq;
      g.gain.setValueAtTime(vol,audio.currentTime);
      g.gain.linearRampToValueAtTime(0.0001,audio.currentTime+len);
      o.connect(g).connect(audio.destination);
      o.start(); o.stop(audio.currentTime+len);
      voidLayers.push({o,g});
      // Bell "glitter"
      if(Math.random()>0.83){
        let bell = audio.createOscillator(), g = audio.createGain();
        bell.type="sine"; bell.frequency.value = songDNA.basePitch*2.63+rand(-8,7);
        g.gain.value = 0.10;
        bell.connect(g).connect(audio.destination);
        bell.start(); bell.stop(audio.currentTime+0.9+rand(0,0.7));
        g.gain.linearRampToValueAtTime(0.0001,audio.currentTime+0.85+rand(0,0.68));
        voidLayers.push({o:bell,g});
      }
    }
    // === UTIL ===
    function rand(a,b){return a+Math.random()*(b-a);}
  </script>
</body>
</html>
