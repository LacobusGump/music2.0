<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GUMP - Spatial Motion AI Music</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at 50% 50%, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
      color: #00ffaa;
      overflow: hidden;
      touch-action: none;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .app { width: 100%; max-width: 400px; padding: 20px; text-align: center; }
    .logo { font-size: clamp(3rem,12vw,6rem); font-weight:900; background:linear-gradient(45deg,#00ffaa,#ff6b6b,#4ecdc4); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; margin-bottom:0.5rem; animation:pulse 2s ease-in-out infinite; }
    @keyframes pulse {0%,100%{transform:scale(1);}50%{transform:scale(1.05);} }
    .tagline { font-size:clamp(1rem,4vw,1.2rem); opacity:0.8; margin-bottom:3rem; font-weight:300; }
    .start-btn { padding:20px 40px; background:linear-gradient(45deg,#00ffaa,#4ecdc4); color:#000; border:none; border-radius:30px; font-size:1.2rem; font-weight:700; cursor:pointer; transition:all 0.3s ease; box-shadow:0 10px 30px rgba(0,255,170,0.3); margin-bottom:2rem; }
    .start-btn:hover{transform:translateY(-3px); box-shadow:0 15px 40px rgba(0,255,170,0.5);} .start-btn:active{transform:translateY(0);} .hidden {display:none!important;}

    .spatial-viz{width:100%;height:200px;border:2px solid rgba(0,255,170,0.2);border-radius:20px;position:relative;overflow:hidden;background:rgba(0,255,170,0.03);margin-bottom:2rem;}
    .orb{position:absolute;width:60px;height:60px;border-radius:50%;background:radial-gradient(circle,#00ffaa,transparent);top:50%;left:50%;transform:translate(-50%,-50%);transition:all 0.1s ease;box-shadow:0 0 30px rgba(0,255,170,0.5);}
    .trail{position:absolute;width:4px;height:4px;border-radius:50%;background:rgba(0,255,170,0.6);pointer-events:none;animation:fade 1s ease-out forwards;}
    @keyframes fade{from{opacity:1;transform:scale(1);}to{opacity:0;transform:scale(0.1);}}

    .stats{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin-bottom:2rem;}
    .stat{background:rgba(0,255,170,0.1);padding:15px;border-radius:15px;border:1px solid rgba(0,255,170,0.2);backdrop-filter:blur(10px);}
    .stat-value{font-size:1.5rem;font-weight:700;color:#00ffaa;} .stat-label{font-size:0.8rem;opacity:0.7;margin-top:5px;}

    .waveform{height:60px;background:rgba(0,0,0,0.3);border-radius:10px;position:relative;overflow:hidden;margin-bottom:1rem;}
    .wave{position:absolute;bottom:0;width:3px;border-radius:1px;transition:height 0.2s ease;}

    .status{font-size:1rem;color:#4ecdc4;opacity:0.8;animation:breathe 2s ease-in-out infinite;}
    @keyframes breathe{0%,100%{opacity:0.8;}50%{opacity:1;} }

    .error{background:rgba(255,107,107,0.1);border:1px solid rgba(255,107,107,0.3);border-radius:15px;padding:20px;color:#ff6b6b;margin-top:20px;}
  </style>
</head>
<body>
  <div class="app">
    <div class="logo">GUMP</div>
    <div class="tagline">Your Life, Soundtracked by AI</div>
    <button class="start-btn" id="start">ðŸŽµ Start Spatial Audio</button>
    <div class="spatial-viz hidden" id="viz"><div class="orb" id="orb"></div></div>
    <div class="stats hidden" id="stats">
      <div class="stat"><div class="stat-value" id="motion">0</div><div class="stat-label">Motion</div></div>
      <div class="stat"><div class="stat-value" id="bpm">120</div><div class="stat-label">BPM</div></div>
      <div class="stat"><div class="stat-value" id="layers">0</div><div class="stat-label">Layers</div></div>
    </div>
    <div class="waveform hidden" id="waveform"></div>
    <div class="status hidden" id="status">ðŸ§  AI composing your soundtrack...</div>
    <div class="error hidden" id="error"></div>
  </div>

  <script>
    class SpatialAI {
      constructor() {
        this.ctx = null;
        this.motion = 0;
        this.bpm = 120;
        this.layers = 0;
        this.pos = { x: 50, y: 50 };
        this.last = { x: 0, y: 0, z: 0 };
        this.step = 0;
        this.bassLine = 0;
        this.chordProg = 0;
        this.mood = 0;
        this.moodTimer = 0;
        this.motif = [65.41, 82.41, 98.00];
        this.motifIdx = 0;
        this.hook = [261.63, 329.63, 392.00];

        this.scale = [65.41,73.42,82.41,87.31,98.00,110.00,123.47];
        this.chords = [
          [261.63,329.63,415.30,523.25],
          [293.66,369.99,466.16,587.33],
          [329.63,415.30,523.25,659.25],
          [349.23,440.00,554.37,698.46]
        ];

        this.waves = [];
        this.active = false;
        this.init();
      }

      init() {
        document.getElementById('start').onclick = () => this.start();
        this.setupWaveform();
      }

      async start() {
        try {
          if (typeof DeviceMotionEvent?.requestPermission === 'function') {
            const perm = await DeviceMotionEvent.requestPermission();
            if (perm !== 'granted') throw new Error();
          }
          this.ctx = new (window.AudioContext || window.webkitAudioContext)();
          await this.ctx.resume();

          document.getElementById('start').classList.add('hidden');
          ['viz','stats','waveform','status'].forEach(id => document.getElementById(id).classList.remove('hidden'));
          this.active = true;
          this.startSensors();
          this.startSequencer();
          this.animate();
        } catch {
          this.showError('Motion sensors unavailable. Please use a mobile device.');
        }
      }

      startSensors() {
        window.addEventListener('devicemotion', e => {
          if (!this.active) return;
          const acc = e.accelerationIncludingGravity;
          if (!acc || acc.x === null) return;
          const dx = Math.abs(acc.x - this.last.x);
          const dy = Math.abs(acc.y - this.last.y);
          const dz = Math.abs(acc.z - this.last.z);
          this.motion = Math.min(100, Math.sqrt(dx*dx+dy*dy+dz*dz)*25);
          this.last = { x: acc.x, y: acc.y, z: acc.z };
          this.pos.x = Math.max(0,Math.min(100,50+acc.x*3));
          this.pos.y = Math.max(0,Math.min(100,50+acc.y*3));
          this.bpm = 85 + this.motion*1.2;
          this.layers = Math.min(4,Math.floor(this.motion/20));
          this.addTrail();
        }, { passive:true });
      }

      startSequencer() {
        const tick = () => {
          if (!this.active) return;
          this.playStep();
          this.step = (this.step+1)%16;
          if (this.step%4===0) this.bassLine=(this.bassLine+1)%8;
          if (this.step===0) {
            this.chordProg=(this.chordProg+1)%4;
            this.moodTimer++;
            if (this.moodTimer>16) {
              if (this.motion>40 && this.mood<2) this.mood++;
              else if (this.motion<10 && this.mood>0) this.mood--;
              this.moodTimer=0;
            }
            if (this.mood===2) this.playHook();
          }
          setTimeout(tick,60000/this.bpm/4);
        };
        tick();
      }

      playStep() {
        if (this.motion<5) return;
        if ([0,6,10,14].includes(this.step)) this.kick();
        if ([4,12].includes(this.step)) this.snare();
        if (this.layers>0 && (this.step%2===1 || (this.motion>50&&Math.random()<0.3))) this.hihat();
        if (this.layers>1 && this.mood>=1 && [0,3,6,9,12,15].includes(this.step)) this.subbass();
        if (this.layers>2 && this.mood>=1 && Math.random()<this.motion/120) this.arpeggio();
        if (this.layers>3 && this.mood>=2 && this.step%4===0) this.atmosphere();
        if (this.motion>40 && Math.random()<0.1) this.spatialGlitch();
        this.updateWaveform();
      }

      playHook() {
        const now = this.ctx.currentTime;
        this.hook.forEach((f,i) => {
          const o = this.ctx.createOscillator(), g = this.ctx.createGain();
          o.frequency.value=f;
          g.gain.setValueAtTime(0.6,now+i*0.2);
          g.gain.exponentialRampToValueAtTime(0.001,now+i*0.2+0.4);
          o.connect(g).connect(this.ctx.destination);
          o.start(now+i*0.2); o.stop(now+i*0.2+0.4);
        });
      }

      // ... (kick/snare/hihat/subbass/arpeggio/atmosphere/spatialGlitch unchanged)

      animate() {
        if (!this.active) return;
        const orb = document.getElementById('orb');
        orb.style.left=`${this.pos.x}%`;
        orb.style.top=`${this.pos.y}%`;
        orb.style.transform=`translate(-50%,-50%) scale(${1+this.motion*0.02})`;
        document.getElementById('motion').textContent=Math.round(this.motion);
        document.getElementById('bpm').textContent=Math.round(this.bpm);
        document.getElementById('layers').textContent=this.layers;
        requestAnimationFrame(()=>this.animate());
      }

      showError(msg) {
        document.getElementById('start').classList.add('hidden');
        const e = document.getElementById('error');
        e.textContent = msg;
        e.classList.remove('hidden');
      }
    }

    new SpatialAI();
  </script>
</body>
</html>
