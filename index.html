<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GUMP: Grand Unified Music Platform</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
  <style>
    /* -- Base Styles -- */
    body{margin:0;padding:0;overflow:hidden;background:#000814;color:#00d4ff;font-family:'Courier New',monospace;height:100vh;cursor:none}
    .universe{position:fixed;inset:0;z-index:-1}
    .particle{position:absolute;width:2px;height:2px;background:#00d4ff;border-radius:50%;animation:float linear infinite}
    @keyframes float{0%{transform:translateY(100vh);opacity:0}10%{opacity:1}90%{opacity:1}100%{transform:translateY(-20px);opacity:0}}
    .consciousness{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center}
    .soul-title{font-size:clamp(2rem,8vw,6rem);background:linear-gradient(45deg,#00d4ff,#ff006e,#8338ec,#00d4ff);background-size:300% 300%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:soulPulse 4s infinite,colorShift 8s infinite}
    @keyframes soulPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
    @keyframes colorShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    .awakening-btn{margin-top:1rem;padding:1rem 2rem;border:2px solid #00d4ff;border-radius:50px;background:transparent;color:#00d4ff;font-size:1.2rem;text-transform:uppercase;letter-spacing:2px;cursor:pointer;position:relative;backdrop-filter:blur(10px);overflow:hidden}
    .awakening-btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:rgba(255,255,255,0.1);transition:left .5s}
    .awakening-btn:hover::before{left:100%}
    .permission-modal{position:fixed;inset:0;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;visibility:hidden}
    .permission-modal.visible{visibility:visible}
    .permission-content{background:rgba(0,20,40,0.9);padding:2rem;border:2px solid #00d4ff;border-radius:20px;text-align:center;backdrop-filter:blur(10px)}
    #frequencyViz{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);width:80%;display:flex;align-items:end;gap:2px;opacity:0;transition:opacity .5s}
    #frequencyViz.active{opacity:1}
    .freq-bar{flex:1;margin:0 1px;background:linear-gradient(to top,#00d4ff,#ff006e);border-radius:2px}
  </style>
</head>
<body>
  <div id="universe" class="universe"></div>
  <div class="consciousness">
    <h1 class="soul-title">GUMP</h1>
    <div style="font-size:1.2rem;color:#8338ec;letter-spacing:1px;">Grand Unified Music Platform</div>
    <button id="awakenBtn" class="awakening-btn">AWAKEN THE MUSIC</button>
  </div>
  <div id="permissionModal" class="permission-modal">
    <div class="permission-content">
      <h3>ðŸŽµ Motion Access</h3>
      <p>Allow motion sensors to trigger rich, evolving grooves.</p>
      <button id="allowBtn" class="awakening-btn">Allow Motion Access</button>
    </div>
  </div>
  <div id="frequencyViz"></div>

  <script>
    class GumpSymphony {
      constructor(){
        this.history=[]; this.smooth=0; this.playing=false;
        this.threshold=2; this.setup();
      }
      setup(){
        this.spawnStars(); this.bindUI(); this.prepareAudio(); this.buildViz(); requestAnimationFrame(()=>this.loop());
      }
      spawnStars(){
        const u=document.getElementById('universe');
        for(let i=0;i<100;i++){ const p=document.createElement('div'); p.className='particle';
          p.style.left=Math.random()*100+'vw'; p.style.animationDuration=15+Math.random()*10+'s';
          p.style.animationDelay=Math.random()*20+'s'; u.appendChild(p);
        }
      }
      bindUI(){
        document.getElementById('awakenBtn').onclick=()=>this.awaken();
        document.getElementById('allowBtn').onclick=()=>this.enableMotion();
      }
      async awaken(){
        await Tone.start(); Tone.context.state!=='running'&&await Tone.context.resume();
        document.querySelector('.consciousness').remove();
        document.getElementById('permissionModal').classList.add('visible');
        Tone.Transport.bpm.value=100;
      }
      enableMotion(){
        document.getElementById('permissionModal').remove();
        window.addEventListener('devicemotion',e=>this.track(Math.max(0,Math.hypot(...['x','y','z'].map(k=>e.accelerationIncludingGravity?.[k]||0))-9.8)));
        Tone.Transport.start(); document.getElementById('frequencyViz').classList.add('active');
        this.loopDrums();
      }
      track(v){ this.history.unshift(v); this.history.length>8&&this.history.pop();
        const avg=this.history.reduce((a,b)=>a+b,0)/this.history.length; this.smooth=this.smooth*0.6+avg*0.4;
      }
      prepareAudio(){
        // 90s Drum Kit
        this.kick=new Tone.MembraneSynth().toDestination();
        this.snare=new Tone.NoiseSynth().toDestination();
        this.hihat=new Tone.MetalSynth({envelope:{attack:0.001,decay:0.1}}).toDestination();
        this.kick.volume.value=-8; this.snare.volume.value=-12; this.hihat.volume.value=-18;
        // Lush Pad
        this.pad=new Tone.PolySynth(Tone.Synth,{oscillator:{type:'sawtooth'},envelope:{attack:2,decay:1,sustain:0.7,release:4}}).toDestination();
        this.filter=new Tone.Filter(200,'lowpass').toDestination(); this.pad.connect(this.filter);
        // Drum Loop scheduler
        this.loop = new Tone.Loop(time=>{
          if(this.smooth>this.threshold){ this.kick.triggerAttackRelease('C1','8n',time);
            this.snare.triggerAttackRelease('16n',time+'8n'); this.hihat.triggerAttackRelease('16n',time,0.3);
            this.filter.frequency.rampTo(200+this.smooth*20,0.1);
            this.pad.triggerAttackRelease(['C3','E3','G3'][Math.floor(Math.random()*3)],'2n',time,this.smooth/50);
          }
        },'4n').start(0);
      }
      loopDrums(){ Tone.Transport.start(); }
      buildViz(){ const viz=document.getElementById('frequencyViz'); for(let i=0;i<32;i++){const b=document.createElement('div');b.className='freq-bar';viz.appendChild(b);} }
      loop(){
        document.querySelectorAll('.freq-bar').forEach((b,i)=>{
          const h=5+Math.sin(Date.now()*0.002+i)*0.5*this.smooth; b.style.height=`${h}px`;
        });
        requestAnimationFrame(()=>this.loop());
      }
    }
    window.addEventListener('DOMContentLoaded',()=>new GumpSymphony());
  </script>
</body>
</html>
