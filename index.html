<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Life Soundtrack: Enhanced Adaptive Music</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
  <style>
    body {
      font-family: 'Courier New', monospace;
      background: radial-gradient(circle at center, #001100 0%, #000 100%);
      color: #0f0;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      text-align: center;
    }
    
    .title {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      text-shadow: 0 0 20px #0f0;
      animation: pulse 2s ease-in-out infinite alternate;
    }
    
    @keyframes pulse {
      from { text-shadow: 0 0 20px #0f0; }
      to { text-shadow: 0 0 30px #0f0, 0 0 40px #0a0; }
    }
    
    .start-btn {
      padding: 15px 30px;
      background: linear-gradient(45deg, #0f0, #0a0);
      color: #000;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1.2rem;
      margin-bottom: 20px;
      text-transform: uppercase;
      font-weight: bold;
      box-shadow: 0 0 20px rgba(0,255,0,0.3);
      transition: all 0.3s;
    }
    
    .start-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 0 30px rgba(0,255,0,0.5);
    }
    
    .controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    .control-btn {
      padding: 10px 20px;
      background: rgba(0,255,0,0.1);
      color: #0f0;
      border: 2px solid #0f0;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s;
    }
    
    .control-btn:hover {
      background: rgba(0,255,0,0.2);
      transform: translateY(-2px);
    }
    
    .control-btn.active {
      background: rgba(0,255,0,0.4);
      box-shadow: 0 0 15px rgba(0,255,0,0.5);
    }
    
    .status {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
      margin: 20px 0;
      font-size: 0.9rem;
    }
    
    .status-item {
      background: rgba(0,255,0,0.1);
      padding: 15px;
      border-radius: 8px;
      border: 1px solid rgba(0,255,0,0.3);
      backdrop-filter: blur(10px);
    }
    
    .layer-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 10px;
      margin: 15px 0;
    }
    
    .layer-indicator {
      background: rgba(0,255,0,0.1);
      border: 2px solid rgba(0,255,0,0.3);
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      font-size: 0.8rem;
      transition: all 0.3s;
    }
    
    .layer-indicator.active {
      background: rgba(0,255,0,0.3);
      border-color: #0f0;
      box-shadow: 0 0 15px rgba(0,255,0,0.5);
      transform: scale(1.05);
    }
    
    .evolution-bar {
      width: 100%;
      height: 25px;
      background: rgba(0,255,0,0.1);
      border: 2px solid rgba(0,255,0,0.3);
      border-radius: 15px;
      overflow: hidden;
      margin: 10px 0;
    }
    
    .evolution-progress {
      height: 100%;
      background: linear-gradient(90deg, #0f0, #0a0, #0f0);
      background-size: 200% 100%;
      animation: shimmer 2s ease-in-out infinite;
      transition: width 0.5s ease;
      box-shadow: 0 0 20px rgba(0,255,0,0.5);
    }
    
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    .rhythm-pattern {
      display: flex;
      justify-content: center;
      gap: 5px;
      margin: 10px 0;
    }
    
    .beat-dot {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: rgba(0,255,0,0.3);
      transition: all 0.2s;
    }
    
    .beat-dot.active {
      background: #0f0;
      box-shadow: 0 0 15px #0f0;
      transform: scale(1.3);
    }
    
    .complexity-bars {
      display: flex;
      justify-content: center;
      gap: 3px;
      margin: 10px 0;
    }
    
    .complexity-bar {
      width: 8px;
      height: 30px;
      background: rgba(0,255,0,0.2);
      border-radius: 4px;
      transition: all 0.3s;
    }
    
    .complexity-bar.active {
      background: #0f0;
      box-shadow: 0 0 10px #0f0;
    }
    
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="title">LIFE SOUNDTRACK ENHANCED</h1>
    <button class="start-btn" id="startBtn">Initialize Neural Audio</button>
    
    <div class="controls hidden" id="controls">
      <button class="control-btn" id="btnMotionPermission">Enable Motion Detection</button>
      <button class="control-btn" id="btnComplexity">Force Evolution</button>
      <button class="control-btn" id="btnChaos">Chaos Mode</button>
      <div style="margin-top: 10px; font-size: 0.8rem; color: #0a0;">
        <div id="motionStatus">Motion detection inactive</div>
        <div id="motionDebug">Move device to trigger evolution</div>
      </div>
    </div>
    
    <div class="status hidden" id="status">
      <div class="status-item">
        <div>Motion: <span id="motionLevel">0</span></div>
        <div>State: <span id="currentState">Still</span></div>
        <div>Evolution: <span id="evolutionLevel">0</span>%</div>
      </div>
      <div class="status-item">
        <div>Tempo: <span id="currentTempo">72</span> BPM</div>
        <div>Key: <span id="currentKey">A Minor</span></div>
        <div>Layers: <span id="layerCount">1</span>/12</div>
      </div>
      <div class="status-item">
        <div>Stage: <span id="evolutionStage">Dormant</span></div>
        <div>Complexity: <span id="complexity">Minimal</span></div>
        <div>Chaos: <span id="chaosLevel">0</span>%</div>
      </div>
    </div>
    
    <div class="layers hidden" id="layers">
      <div>Evolution Progress:</div>
      <div class="evolution-bar">
        <div class="evolution-progress" id="evolutionProgress"></div>
      </div>
      
      <div class="complexity-bars">
        <div class="complexity-bar" data-level="1"></div>
        <div class="complexity-bar" data-level="2"></div>
        <div class="complexity-bar" data-level="3"></div>
        <div class="complexity-bar" data-level="4"></div>
        <div class="complexity-bar" data-level="5"></div>
        <div class="complexity-bar" data-level="6"></div>
        <div class="complexity-bar" data-level="7"></div>
        <div class="complexity-bar" data-level="8"></div>
        <div class="complexity-bar" data-level="9"></div>
        <div class="complexity-bar" data-level="10"></div>
      </div>
      
      <div class="rhythm-pattern" id="rhythmPattern"></div>
      
      <div class="layer-grid" id="layerGrid"></div>
    </div>
  </div>

  <script>
    const KEYS = {
      A_MINOR: {
        name: 'A Minor',
        chords: {
          i: ['A3', 'C4', 'E4'],
          ii: ['B3', 'D4', 'F4'],
          III: ['C4', 'E4', 'G4'],
          iv: ['D4', 'F4', 'A4'],
          v: ['E4', 'G4', 'B4'],
          VI: ['F4', 'A4', 'C5'],
          VII: ['G4', 'B4', 'D5'],
          'i7': ['A3', 'C4', 'E4', 'G4'],
          'ii7': ['B3', 'D4', 'F4', 'A4']
        }
      },
      D_MINOR: {
        name: 'D Minor',
        chords: {
          i: ['D3', 'F3', 'A3'],
          ii: ['E3', 'G3', 'Bb3'],
          III: ['F3', 'A3', 'C4'],
          iv: ['G3', 'Bb3', 'D4']
        }
      }
    };
    
    const PROGRESSIONS = {
      dormant: ['i'],
      awakening: ['i', 'VI', 'iv'],
      building: ['i', 'VI', 'III', 'VII', 'iv'],
      active: ['i', 'iv', 'VI', 'v', 'III', 'VII'],
      evolved: ['i7', 'ii7', 'VI', 'iv', 'v', 'VII', 'III', 'i'],
      transcendent: ['i7', 'ii7', 'VI', 'iv', 'v', 'VII', 'III', 'i', 'ii', 'VI', 'iv', 'v']
    };
    
    const LAYERS = {
      ambient: { name: 'Ambient', threshold: 0, info: 'Base atmosphere' },
      harmony: { name: 'Harmony', threshold: 5, info: 'Chord progressions' },
      bass: { name: 'Bass', threshold: 10, info: 'Low frequencies' },
      drums: { name: 'Drums', threshold: 15, info: 'Percussion' },
      melody: { name: 'Melody', threshold: 25, info: 'Lead lines' },
      texture: { name: 'Texture', threshold: 30, info: 'Atmospheric noise' },
      polyrhythm: { name: 'Polyrhythm', threshold: 35, info: '3/4 over 4/4' },
      microtonal: { name: 'Microtonal', threshold: 40, info: 'Quarter tones' },
      granular: { name: 'Granular', threshold: 45, info: 'Grain synthesis' },
      chaos: { name: 'Chaos', threshold: 50, info: 'Algorithmic patterns' },
      neural: { name: 'Neural', threshold: 60, info: 'AI-generated' },
      quantum: { name: 'Quantum', threshold: 70, info: 'Probability-based' }
    };
    
    let state = {
      active: false,
      currentKey: KEYS.A_MINOR,
      motionIntensity: 0,
      activityState: 'still',
      tempo: 72,
      evolutionStage: 'dormant',
      evolutionLevel: 0,
      activeLayers: new Set(['ambient']),
      complexity: 0,
      chaosLevel: 0,
      chordIndex: 0,
      beatCount: 0,
      motionPermissionGranted: false,
      forceEvolution: false,
      chaosMode: false,
      lastMotionTime: 0,
      motionHistory: []
    };
    
    let instruments = {};
    let effects = {};
    let audioInitialized = false;
    
    async function initAudio() {
      if (audioInitialized) return;
      
      await Tone.start();
      
      // Effects
      effects.reverb = new Tone.Reverb(4);
      effects.delay = new Tone.PingPongDelay("8n", 0.3);
      effects.chorus = new Tone.Chorus(6, 2.5, 0.7);
      effects.filter = new Tone.Filter(800, "lowpass");
      effects.distortion = new Tone.Distortion(0.6);
      
      await effects.reverb.generate();
      
      // Instruments
      instruments.ambient = new Tone.PolySynth(Tone.AMSynth, {
        harmonicity: 3,
        oscillator: { type: "sine" },
        envelope: { attack: 4, decay: 3, sustain: 0.9, release: 6 }
      }).chain(effects.reverb, effects.chorus, Tone.Destination);
      
      instruments.harmony = new Tone.PolySynth(Tone.FMSynth, {
        harmonicity: 2.5,
        oscillator: { type: "triangle" },
        envelope: { attack: 1.2, decay: 1.8, sustain: 0.8, release: 3.5 }
      }).chain(effects.filter, effects.delay, Tone.Destination);
      
      instruments.bass = new Tone.MonoSynth({
        oscillator: { type: "fatsawtooth" },
        envelope: { attack: 0.05, decay: 0.4, sustain: 0.7, release: 1.2 }
      }).chain(effects.distortion, Tone.Destination);
      
      instruments.drums = new Tone.MembraneSynth({
        pitchDecay: 0.12,
        octaves: 3,
        envelope: { attack: 0.001, decay: 0.4, sustain: 0.02, release: 1.8 }
      }).chain(effects.reverb, Tone.Destination);
      
      instruments.melody = new Tone.DuoSynth({
        vibratoAmount: 0.4,
        vibratoRate: 8,
        voice0: { oscillator: { type: "square" }, envelope: { attack: 0.01, decay: 0.15, sustain: 0.5, release: 0.8 } }
      }).chain(effects.delay, Tone.Destination);
      
      instruments.texture = new Tone.NoiseSynth({
        noise: { type: "pink" },
        envelope: { attack: 0.3, decay: 0.8, sustain: 0.3, release: 1.5 }
      }).chain(effects.filter, effects.reverb, Tone.Destination);
      
      instruments.polyrhythm = new Tone.PolySynth(Tone.Synth, {
        oscillator: { type: "sawtooth" },
        envelope: { attack: 0.1, decay: 0.3, sustain: 0.4, release: 0.7 }
      }).chain(effects.delay, Tone.Destination);
      
      instruments.chaos = new Tone.PolySynth(Tone.Synth, {
        oscillator: { type: "square" },
        envelope: { attack: 0.01, decay: 0.2, sustain: 0.1, release: 0.3 }
      }).chain(effects.distortion, Tone.Destination);
      
      Object.keys(instruments).forEach(key => {
        instruments[key].volume.value = -20;
      });
      
      Tone.Transport.bpm.value = state.tempo;
      Tone.Transport.start();
      
      audioInitialized = true;
      startSequence();
    }
    
    function startSequence() {
      Tone.Transport.scheduleRepeat((time) => {
        state.beatCount++;
        
        if (state.beatCount % 4 === 0) playChord(time);
        if (state.beatCount % 2 === 0 && state.activeLayers.has('bass')) playBass(time);
        if (state.activeLayers.has('drums')) playDrums(time);
        if (state.activeLayers.has('harmony') && state.beatCount % 6 === 0) playHarmony(time);
        if (state.activeLayers.has('melody') && state.beatCount % 8 === 0) playMelody(time);
        if (state.activeLayers.has('texture') && Math.random() < 0.3) playTexture(time);
        if (state.activeLayers.has('polyrhythm') && state.beatCount % 3 === 0) playPolyrhythm(time);
        if (state.activeLayers.has('chaos') && Math.random() < 0.4) playChaos(time);
        
        evolveMusic();
        updateUI();
        updateRhythmDisplay();
      }, '4n');
    }
    
    function playChord(time) {
      const progression = PROGRESSIONS[state.evolutionStage];
      const chordName = progression[state.chordIndex % progression.length];
      const chord = state.currentKey.chords[chordName];
      
      if (chord && state.activeLayers.has('ambient')) {
        instruments.ambient.triggerAttackRelease(chord, '2n', time);
      }
      
      state.chordIndex++;
    }
    
    function playBass(time) {
      const progression = PROGRESSIONS[state.evolutionStage];
      const chordName = progression[state.chordIndex % progression.length];
      const chord = state.currentKey.chords[chordName];
      
      if (chord) {
        const bassNote = chord[0].replace('3', '2');
        instruments.bass.triggerAttackRelease(bassNote, '8n', time);
      }
    }
    
    function playDrums(time) {
      const patterns = {
        still: [1, 0, 0, 0],
        walking: [1, 0, 1, 0],
        running: [1, 1, 0, 1],
        dancing: [1, 1, 1, 1]
      };
      
      const pattern = patterns[state.activityState];
      const beat = state.beatCount % 4;
      
      if (pattern[beat]) {
        const pitch = ['C2', 'D2', 'E2'][Math.floor(Math.random() * 3)];
        instruments.drums.triggerAttackRelease(pitch, '16n', time);
      }
    }
    
    function playHarmony(time) {
      const progression = PROGRESSIONS[state.evolutionStage];
      const chordName = progression[state.chordIndex % progression.length];
      const chord = state.currentKey.chords[chordName];
      
      if (chord) {
        const upperChord = chord.map(note => note.replace(/\d/, '5'));
        instruments.harmony.triggerAttackRelease(upperChord, '4n', time);
      }
    }
    
    function playMelody(time) {
      const scale = ['A4', 'B4', 'C5', 'D5', 'E5', 'F5', 'G5'];
      const note = scale[Math.floor(Math.random() * scale.length)];
      instruments.melody.triggerAttackRelease(note, '8n', time);
    }
    
    function playTexture(time) {
      instruments.texture.triggerAttackRelease('16n', time);
    }
    
    function playPolyrhythm(time) {
      const notes = ['A4', 'C5', 'E5'];
      const note = notes[Math.floor(Math.random() * notes.length)];
      instruments.polyrhythm.triggerAttackRelease(note, '8n', time);
    }
    
    function playChaos(time) {
      const notes = ['C4', 'D4', 'E4', 'F4', 'G4', 'A4', 'B4'];
      const note = notes[Math.floor(Math.random() * notes.length)];
      instruments.chaos.triggerAttackRelease(note, '16n', time);
    }
    
    function evolveMusic() {
      if (state.forceEvolution) {
        state.evolutionLevel = Math.min(100, state.evolutionLevel + 2);
      } else {
        state.evolutionLevel = Math.min(100, state.evolutionLevel + state.motionIntensity * 0.1);
      }
      
      updateEvolutionStage();
      updateActiveLayers();
      updateTempo();
      updateComplexity();
    }
    
    function updateEvolutionStage() {
      const stages = [
        { name: 'dormant', threshold: 0 },
        { name: 'awakening', threshold: 10 },
        { name: 'building', threshold: 25 },
        { name: 'active', threshold: 40 },
        { name: 'evolved', threshold: 65 },
        { name: 'transcendent', threshold: 80 }
      ];
      
      for (let i = stages.length - 1; i >= 0; i--) {
        if (state.evolutionLevel >= stages[i].threshold) {
          state.evolutionStage = stages[i].name;
          break;
        }
      }
    }
    
    function updateActiveLayers() {
      Object.entries(LAYERS).forEach(([key, layer]) => {
        if (state.evolutionLevel >= layer.threshold) {
          state.activeLayers.add(key);
        }
      });
    }
    
    function updateTempo() {
      const baseTempo = 72;
      const tempoBoost = Math.floor(state.evolutionLevel * 0.8);
      state.tempo = baseTempo + tempoBoost;
      
      if (state.chaosMode) {
        state.tempo += Math.floor(Math.random() * 20) - 10;
      }
      
      Tone.Transport.bpm.rampTo(state.tempo, 0.5);
    }
    
    function updateComplexity() {
      state.complexity = Math.floor(state.evolutionLevel / 10);
      
      if (state.chaosMode) {
        state.chaosLevel = Math.min(100, state.chaosLevel + 1);
      } else {
        state.chaosLevel = Math.max(0, state.chaosLevel - 0.5);
      }
    }
    
    function updateUI() {
      document.getElementById('motionLevel').textContent = state.motionIntensity.toFixed(1);
      document.getElementById('currentState').textContent = state.activityState;
      document.getElementById('evolutionLevel').textContent = state.evolutionLevel.toFixed(0);
      document.getElementById('currentTempo').textContent = state.tempo;
      document.getElementById('currentKey').textContent = state.currentKey.name;
      document.getElementById('evolutionStage').textContent = state.evolutionStage;
      document.getElementById('layerCount').textContent = state.activeLayers.size;
      document.getElementById('complexity').textContent = ['Minimal', 'Simple', 'Basic', 'Growing', 'Moderate', 'Complex', 'Rich', 'Dense', 'Intense', 'Overwhelming', 'Transcendent'][state.complexity] || 'Transcendent';
      document.getElementById('chaosLevel').textContent = state.chaosLevel.toFixed(0);
      
      // Update evolution bar
      document.getElementById('evolutionProgress').style.width = state.evolutionLevel + '%';
      
      // Update complexity bars
      document.querySelectorAll('.complexity-bar').forEach((bar, index) => {
        bar.classList.toggle('active', index < state.complexity);
      });
      
      // Update layer grid
      updateLayerGrid();
    }
    
    function updateLayerGrid() {
      const layerGrid = document.getElementById('layerGrid');
      layerGrid.innerHTML = '';
      
      Object.entries(LAYERS).forEach(([key, layer]) => {
        const layerDiv = document.createElement('div');
        layerDiv.className = 'layer-indicator';
        layerDiv.innerHTML = `
          <div class="layer-name">${layer.name}</div>
          <div class="layer-info">${layer.info}</div>
        `;
        
        if (state.activeLayers.has(key)) {
          layerDiv.classList.add('active');
        }
        
        layerGrid.appendChild(layerDiv);
      });
    }
    
    function updateRhythmDisplay() {
      const rhythmPattern = document.getElementById('rhythmPattern');
      rhythmPattern.innerHTML = '';
      
      const patternLength = 8;
      const currentBeat = state.beatCount % patternLength;
      
      for (let i = 0; i < patternLength; i++) {
        const beatDot = document.createElement('div');
        beatDot.className = 'beat-dot';
        
        if (i === currentBeat) {
          beatDot.classList.add('active');
        }
        
        rhythmPattern.appendChild(beatDot);
      }
    }
    
    function requestMotionPermission() {
      if (typeof DeviceMotionEvent.requestPermission === 'function') {
        DeviceMotionEvent.requestPermission()
          .then(response => {
            if (response === 'granted') {
              startMotionDetection();
            }
          })
          .catch(console.error);
      } else {
        startMotionDetection();
      }
    }
    
    function startMotionDetection() {
      state.motionPermissionGranted = true;
      document.getElementById('motionStatus').textContent = 'Motion detection active';
      document.getElementById('btnMotionPermission').classList.add('active');
      
      window.addEventListener('devicemotion', (event) => {
        if (!state.active) return;
        
        const acceleration = event.acceleration;
        if (acceleration) {
          const totalAcceleration = Math.sqrt(
            acceleration.x * acceleration.x +
            acceleration.y * acceleration.y +
            acceleration.z * acceleration.z
          );
          
          state.motionIntensity = Math.min(totalAcceleration * 2, 20);
          state.lastMotionTime = Date.now();
          
          // Update activity state
          if (state.motionIntensity > 15) {
            state.activityState = 'dancing';
          } else if (state.motionIntensity > 8) {
            state.activityState = 'running';
          } else if (state.motionIntensity > 3) {
            state.activityState = 'walking';
          } else {
            state.activityState = 'still';
          }
          
          // Decay motion over time
          setTimeout(() => {
            if (Date.now() - state.lastMotionTime > 1000) {
              state.motionIntensity *= 0.9;
            }
          }, 1000);
        }
      });
    }
    
    // Event listeners
    document.getElementById('startBtn').addEventListener('click', async () => {
      if (!state.active) {
        await initAudio();
        state.active = true;
        document.getElementById('startBtn').textContent = 'Neural Audio Active';
        document.getElementById('controls').classList.remove('hidden');
        document.getElementById('status').classList.remove('hidden');
        document.getElementById('layers').classList.remove('hidden');
      }
    });
    
    document.getElementById('btnMotionPermission').addEventListener('click', requestMotionPermission);
    
    document.getElementById('btnComplexity').addEventListener('click', () => {
      state.forceEvolution = !state.forceEvolution;
      document.getElementById('btnComplexity').classList.toggle('active', state.forceEvolution);
    });
    
    document.getElementById('btnChaos').addEventListener('click', () => {
      state.chaosMode = !state.chaosMode;
      document.getElementById('btnChaos').classList.toggle('active', state.chaosMode);
    });
    
    // Initialize UI
    updateUI();
    updateRhythmDisplay();
  </script>
</body>
</html>ml>
