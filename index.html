<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GUMP - Predictive Motion AI Music</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at 40% 60%, #0a0a0a, #16213e);
      color: #00ffaa;
      overflow: hidden;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      transition: background 1s;
    }

    #start-btn {
      padding: 15px 30px;
      border: none;
      border-radius: 20px;
      background: #00ffaa;
      color: #000;
      cursor: pointer;
      font-size: 1.2rem;
      font-weight: bold;
    }

    #motion-status {
      margin-top: 20px;
      font-size: 1rem;
    }

  </style>
</head>
<body>
  <button id="start-btn">Start GUMP AI Music</button>
  <div id="motion-status">Waiting for motion...</div>

  <script>
    const statusEl = document.getElementById('motion-status');
    let previousAcc = 0;
    let motionBuffer = [];

    async function initAudio() {
      await Tone.start();
      statusEl.textContent = "Audio initialized. Move your phone!";

      const synth = new Tone.PolySynth(Tone.Synth).toDestination();
      const reverb = new Tone.Reverb({ decay: 4, wet: 0.5 }).toDestination();
      synth.connect(reverb);

      const notes = ["C4", "E4", "G4", "B4", "D5", "F#5", "A5"];

      window.addEventListener('devicemotion', (event) => {
        const acc = event.accelerationIncludingGravity;
        const totalAcc = Math.sqrt(acc.x ** 2 + acc.y ** 2 + acc.z ** 2);

        if (motionBuffer.length > 20) motionBuffer.shift();
        motionBuffer.push(totalAcc);

        const avgAcc = motionBuffer.reduce((a, b) => a + b, 0) / motionBuffer.length;

        // Predictive Model
        const predictedIntensity = avgAcc + (avgAcc - previousAcc);
        previousAcc = avgAcc;

        statusEl.textContent = `Motion Intensity: ${predictedIntensity.toFixed(2)}`;

        if (predictedIntensity > 15) {
          playDynamicChord(synth, notes, predictedIntensity);
          document.body.style.background = 'radial-gradient(circle at 40% 60%, #1a1a2e, #16213e)';
        } else if (predictedIntensity > 7) {
          playDynamicMelody(synth, notes, predictedIntensity);
          document.body.style.background = 'radial-gradient(circle at 40% 60%, #0a1a1a, #16213e)';
        }
      });
    }

    function playDynamicChord(synth, notes, intensity) {
      const chord = [notes[0], notes[2], notes[4], notes[6]];
      synth.triggerAttackRelease(chord, 1.5, Tone.now(), intensity / 100);
    }

    function playDynamicMelody(synth, notes, intensity) {
      const note = notes[Math.floor(Math.random() * notes.length)];
      synth.triggerAttackRelease(note, 0.8, Tone.now(), intensity / 100);
    }

    document.getElementById('start-btn').onclick = () => {
      initAudio();
      document.getElementById('start-btn').style.display = 'none';
    };
  </script>
</body>
</html>
