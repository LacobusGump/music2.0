<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GUMP - Weather + Spatial AI Music</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      font-family: 'Helvetica Neue', sans-serif;
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
      color: white; overflow: hidden; height: 100vh;
    }
    .app { position: relative; text-align: center; padding: 40px 20px; height: 100vh;
      display: flex; flex-direction: column; justify-content: center; align-items: center;
    }
    .logo {
      font-size: 4rem; font-weight: 900; letter-spacing: 8px;
      background: linear-gradient(45deg, #00ffff, #ff00ff, #ffff00);
      background-size: 200% 200%;
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      animation: gradient-shift 3s ease infinite;
      text-shadow: 0 0 30px rgba(0,255,255,0.5); margin-bottom: 20px;
    }
    @keyframes gradient-shift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .tagline { font-size: 1.4rem; margin-bottom: 40px; opacity: 0.9; font-weight: 300; }
    .weather-status {
      font-size: 1.2rem; margin-bottom: 30px;
      padding: 15px 30px; background: rgba(255,255,255,0.1);
      border-radius: 25px; backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
    }
    .start-btn {
      font-size: 1.1rem; padding: 15px 40px;
      background: linear-gradient(45deg, #00ffff, #0099cc);
      color: #111; border: none; border-radius: 30px;
      cursor: pointer; font-weight: bold; text-transform: uppercase;
      transition: all 0.3s ease; box-shadow: 0 8px 25px rgba(0,255,255,0.3);
    }
    .start-btn:hover { transform: translateY(-2px); box-shadow: 0 12px 35px rgba(0,255,255,0.5); }
    .start-btn:active { transform: translateY(0); }
    .error { color: #ff4444; font-weight: bold; margin-top: 20px;
      padding: 15px; background: rgba(255,0,0,0.1); border-radius: 10px;
      border: 1px solid rgba(255,0,0,0.3);
    }
    .hidden { display: none !important; }
    .spatial-viz { position: fixed; top:0; left:0; width:100vw; height:100vh;
      pointer-events: none; z-index:1;
    }
    .orb {
      position: absolute; width:60px; height:60px;
      background: radial-gradient(circle at 30% 30%, #00ffff 0%, #0088aa 50%, #004455 100%);
      border-radius:50%; box-shadow:0 0 40px #00ffff, 0 0 80px rgba(0,255,255,0.3);
      transform: translate(-50%,-50%); transition: all 0.3s ease;
      animation: pulse-orb 2s infinite alternate;
    }
    @keyframes pulse-orb { 0% { transform: translate(-50%,-50%) scale(1); } 100% { transform: translate(-50%,-50%) scale(1.1); } }
    .stats {
      position: fixed; bottom:40px; left:50%; transform:translateX(-50%);
      display:flex; gap:30px;
      background: rgba(0,0,0,0.7); padding:20px 30px;
      border-radius:20px; backdrop-filter: blur(15px);
      border:1px solid rgba(255,255,255,0.1); z-index:10;
    }
    .stat { text-align:center; min-width:80px; }
    .stat-value { font-size:1.8rem; font-weight:bold; color:#00ffff;
      text-shadow:0 0 10px rgba(0,255,255,0.5);
    }
    .stat-label { font-size:0.8rem; color:#aaa; text-transform:uppercase; letter-spacing:1px; }
    .status {
      position: fixed; top:30px; left:50%; transform:translateX(-50%);
      font-size:1.1rem; font-style:italic; opacity:0.9;
      background:rgba(0,0,0,0.5); padding:15px 25px; border-radius:15px;
      backdrop-filter: blur(10px); z-index:10;
    }
    body.rain { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); }
    body.storm {
      background: linear-gradient(135deg, #2c1810 0%, #3c2415 50%, #4a2c2a 100%);
      animation: lightning 6s infinite;
    }
    @keyframes lightning { 0%,90%,100%{filter:brightness(1);}91%,92%,94%,96%{filter:brightness(2) contrast(1.5);} }
    body.snow {
      background: linear-gradient(135deg, #e6f3ff 0%, #b3d9ff 50%, #80bfff 100%);
      color: #333;
    }
    body.snow .logo {
      background: linear-gradient(45deg, #0066cc, #003d7a, #001a33);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    body.void {
      background: radial-gradient(circle at center, #1a0033 0%, #0d001a 50%, #000000 100%);
      animation: void-pulse 8s infinite alternate;
    }
    @keyframes void-pulse { 0% { filter: brightness(0.7); } 100% { filter: brightness(1.2); } }
    @media (max-width:768px) {
      .logo { font-size:3rem; letter-spacing:4px; }
      .stats { gap:20px; padding:15px 20px; }
      .stat { min-width:60px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="logo">GUMP</div>
    <div class="tagline">Your Life, Soundtracked by AI</div>
    <div class="weather-status" id="weather">üå§Ô∏è Loading weather...</div>
    <button class="start-btn" id="start">üéµ Start Spatial Audio</button>
    <div class="error hidden" id="error"></div>
  </div>

  <div class="spatial-viz hidden" id="viz">
    <div class="orb" id="orb"></div>
  </div>

  <div class="stats hidden" id="stats">
    <div class="stat">
      <div class="stat-value" id="motion">0</div>
      <div class="stat-label">Motion</div>
    </div>
    <div class="stat">
      <div class="stat-value" id="bpm">95</div>
      <div class="stat-label">BPM</div>
    </div>
    <div class="stat">
      <div class="stat-value" id="groove">CHILL</div>
      <div class="stat-label">Groove</div>
    </div>
    <div class="stat">
      <div class="stat-value" id="weather-mode">CLEAR</div>
      <div class="stat-label">Weather</div>
    </div>
  </div>

  <div class="status hidden" id="status">üéµ Flowing with your vibe...</div>

  <script>
class Gump {
  constructor() {
    this.ctx = null;
    this.motion = 0;
    this.bpm = 95;
    this.last = { x: 0, y: 0, z: 0 };
    this.pos = { x: 50, y: 50 };
    this.step = 0;
    this.motionHistory = [];
    this.voidMode = false;
    this.weather = 'clear';
    this.active = false;
    this.hasStarted = false;

    this.masterGain = null;
    this.weatherGain = null;
    this.ambientGain = null;
    this.voidOscs = [];
    this.weatherSources = [];

    this.chordIndex = 0;
    this.bassIndex = 0;
    this.groove = 'CHILL';

    this.stepTime = 0;
    this.nextStepTime = 0;

    this.patterns = {
      kick: [
        {hit:1,vel:0.8},{hit:0,vel:0},{hit:0,vel:0},{hit:0,vel:0},
        {hit:0,vel:0},{hit:0,vel:0},{hit:1,vel:0.6},{hit:0,vel:0},
        {hit:0,vel:0},{hit:0,vel:0},{hit:1,vel:0.7},{hit:0,vel:0},
        {hit:0,vel:0},{hit:0,vel:0},{hit:0,vel:0},{hit:0,vel:0}
      ],
      snare: [
        {hit:0,vel:0},{hit:0,vel:0},{hit:0,vel:0},{hit:0,vel:0},
        {hit:1,vel:0.7},{hit:0,vel:0},{hit:0,vel:0},{hit:0,vel:0},
        {hit:0,vel:0},{hit:0,vel:0},{hit:0,vel:0},{hit:0,vel:0},
        {hit:1,vel:0.8},{hit:0,vel:0},{hit:0,vel:0},{hit:0,vel:0}
      ],
      hat: [
        {hit:0,vel:0},{hit:1,vel:0.3},{hit:0,vel:0},{hit:1,vel:0.2},
        {hit:0,vel:0},{hit:1,vel:0.4},{hit:0,vel:0},{hit:1,vel:0.3},
        {hit:0,vel:0},{hit:1,vel:0.3},{hit:0,vel:0},{hit:1,vel:0.2},
        {hit:0,vel:0},{hit:1,vel:0.4},{hit:0,vel:0},{hit:1,vel:0.3}
      ]
    };

    this.bassNotes = [55,65.4,73.4,82.4];
    this.chords = [
      [220,277.18,329.63],
      [246.94,311.13,369.99],
      [261.63,329.63,392.00],
      [293.66,369.99,440.00]
    ];

    this.init();
  }

  init() {
    document.getElementById('start').addEventListener('click',() => this.start());
    this.getWeather();
    this.setupErrorHandling();
  }

  setupErrorHandling() {
    window.addEventListener('error', e => {
      this.showError('Audio error: ' + e.message);
    });
  }

  showError(message) {
    const el = document.getElementById('error');
    el.textContent = message;
    el.classList.remove('hidden');
    setTimeout(() => el.classList.add('hidden'), 5000);
  }

  async getWeather() {
    try {
      document.getElementById('weather').textContent = 'üåç Getting location...';
      const pos = await new Promise((res, rej) => {
        navigator.geolocation.getCurrentPosition(res, rej, { timeout: 10000 });
      });
      document.getElementById('weather').textContent = 'üå§Ô∏è Fetching weather...';
      const KEY = 'YOUR_REAL_KEY';
      const url = `https://api.openweathermap.org/data/2.5/weather?lat=${pos.coords.latitude}&lon=${pos.coords.longitude}&appid=${KEY}&units=metric`;
      const r = await fetch(url);
      if (!r.ok) throw new Error('API down');
      const d = await r.json();
      this.setWeatherFromData(d);
    } catch (err) {
      console.warn(err);
      this.setDefaultWeather();
    }
  }

  setWeatherFromData(d) {
    const c = d.weather[0].main.toLowerCase();
    this.weather = c.includes('storm')?'storm':c.includes('rain')?'rain':c.includes('snow')?'snow':'clear';
    this.applyWeatherTheme();
    document.getElementById('weather').textContent = `üå§Ô∏è ${d.name} ‚Ä¢ ${Math.round(d.main.temp)}¬∞C ‚Ä¢ ${this.weather.toUpperCase()}`;
  }

  setDefaultWeather() {
    this.weather='clear';
    this.applyWeatherTheme();
    document.getElementById('weather').textContent = 'üå§Ô∏è Clear weather (simulated)';
  }

  applyWeatherTheme() {
    document.body.className = this.weather;
    document.getElementById('weather-mode').textContent = this.weather.toUpperCase();
  }

  async start() {
    if(this.hasStarted) return;
    this.ctx = new (window.AudioContext||window.webkitAudioContext)();
    this.masterGain = this.ctx.createGain(); this.masterGain.gain.value = 0.7; this.masterGain.connect(this.ctx.destination);
    this.weatherGain = this.ctx.createGain(); this.ambientGain = this.ctx.createGain();
    this.weatherGain.connect(this.masterGain); this.ambientGain.connect(this.masterGain);
    if(this.ctx.state==='suspended') await this.ctx.resume();
    document.getElementById('start').classList.add('hidden');
    document.getElementById('viz').classList.remove('hidden');
    document.getElementById('stats').classList.remove('hidden');
    document.getElementById('status').classList.remove('hidden');
    this.hasStarted = this.active = true;
    this.startSensors(); this.startGroove(); this.startWeatherAudio();
    document.getElementById('status').textContent = 'üéµ Flowing with your vibe...';
  }

  startSensors() {
    if(window.DeviceMotionEvent) window.addEventListener('devicemotion', e=>this.handleMotion(e), true);
    else this.setupMouseFallback();
  }

  handleMotion(e) {
    const a=e.accelerationIncludingGravity; if(!a) return;
    const dx=a.x-this.last.x, dy=a.y-this.last.y, dz=a.z-this.last.z;
    this.motion = Math.min(100, Math.sqrt(dx*dx+dy*dy+dz*dz)*8);
    this.motionHistory.push(this.motion); if(this.motionHistory.length>50) this.motionHistory.shift();
    this.last={x:a.x,y:a.y,z:a.z};
    this.pos.x = Math.max(10, Math.min(90,50+a.x*3));
    this.pos.y = Math.max(10, Math.min(90,50+a.y*3));
    this.checkVoidMode(); this.updateGroove(); this.updateVisuals();
  }

  setupMouseFallback() {
    let lx=0, ly=0;
    document.addEventListener('mousemove', e=>{
      const dx=e.clientX-lx, dy=e.clientY-ly;
      this.motion = Math.min(100, Math.sqrt(dx*dx+dy*dy)*2);
      this.motionHistory.push(this.motion); if(this.motionHistory.length>50) this.motionHistory.shift();
      this.pos.x = (e.clientX/window.innerWidth)*100; this.pos.y=(e.clientY/window.innerHeight)*100;
      lx=e.clientX; ly=e.clientY;
      this.checkVoidMode(); this.updateGroove(); this.updateVisuals();
    });
  }

  checkVoidMode() {
    if(this.motionHistory.length<30) return;
    const avg=this.motionHistory.reduce((a,b)=>a+b,0)/this.motionHistory.length;
    if(avg<3&&!this.voidMode) this.enterVoidMode();
    else if(avg>15&&this.voidMode) this.exitVoidMode();
  }

  enterVoidMode() {
    this.voidMode=true; document.body.className='void';
    document.getElementById('status').textContent='‚ú® Floating in the void...';
    this.startVoidAmbient();
  }

  exitVoidMode() {
    this.voidMode=false; this.applyWeatherTheme();
    this.stopVoidAmbient(); document.getElementById('status').textContent='üéµ Flowing with your vibe...';
  }

  startVoidAmbient() {
    this.stopVoidAmbient();
    [220,277.18,329.63,415.30].forEach((freq,i)=>{
      const osc=this.ctx.createOscillator(), gain=this.ctx.createGain(), filter=this.ctx.createBiquadFilter();
      osc.type='sine'; osc.frequency.value=freq;
      filter.type='lowpass'; filter.frequency.value=800;
      gain.gain.value=0; gain.gain.linearRampToValueAtTime(0.08,this.ctx.currentTime+2+i*0.5);
      osc.connect(filter).connect(gain).connect(this.ambientGain);
      osc.start(); this.voidOscs.push(osc);
    });
  }

  stopVoidAmbient() {
    this.voidOscs.forEach(o=>{ try{o.stop()}catch{} }); this.voidOscs=[];
  }

  updateGroove() {
    if(this.voidMode) return;
    if(this.motion<15){ this.groove='CHILL'; this.bpm=85; }
    else if(this.motion<50){ this.groove='POCKET'; this.bpm=100; }
    else { this.groove='BOUNCE'; this.bpm=120; }
  }

  updateVisuals() {
    document.getElementById('orb').style.left = `${this.pos.x}%`;
    document.getElementById('orb').style.top = `${this.pos.y}%`;
    document.getElementById('motion').textContent = Math.round(this.motion);
    document.getElementById('bpm').textContent    = Math.round(this.bpm);
    document.getElementById('groove').textContent = this.groove;
  }

  startGroove() {
    this.stepTime = this.ctx.currentTime; this.nextStepTime = this.stepTime;
    this.scheduleNextStep();
  }

  scheduleNextStep() {
    if(!this.active) return;
    const stepDur = 60/this.bpm/4;
    this.nextStepTime += stepDur;
    if(!this.voidMode) this.playStep();
    this.step = (this.step+1)%16;
    if(this.step%8===0) this.bassIndex = (this.bassIndex+1)%this.bassNotes.length;
    if(this.step%4===0) this.chordIndex = (this.chordIndex+1)%this.chords.length;
    const timeout = (this.nextStepTime - this.ctx.currentTime)*1000;
    setTimeout(()=>this.scheduleNextStep(), Math.max(0, timeout));
  }

  playStep() {
    const now = this.ctx.currentTime, s = this.step;
    if(this.patterns.kick[s].hit) this.playKick(now, this.patterns.kick[s].vel);
    if(this.patterns.snare[s].hit) this.playSnare(now, this.patterns.snare[s].vel);
    if(this.patterns.hat[s].hit) this.playHat(now, this.patterns.hat[s].vel);
    if(s%4===0) this.playChord(now);
    if(s%8===0) this.playBass(now);
    if(this.motion>60 && Math.random()<0.2) this.playSpatialEffect(now);
  }

  playKick(time, vel) {
    const osc = this.ctx.createOscillator(), gain = this.ctx.createGain(), filter = this.ctx.createBiquadFilter();
    osc.type='sine'; osc.frequency.setValueAtTime(60,time); osc.frequency.exponentialRampToValueAtTime(30,time+0.3);
    filter.type='lowpass'; filter.frequency.value=150;
    gain.gain.setValueAtTime(vel,time); gain.gain.exponentialRampToValueAtTime(0.001,time+0.4);
    osc.connect(filter).connect(gain).connect(this.masterGain);
    osc.start(time); osc.stop(time+0.4);
  }

  playSnare(time, vel) {
    const size=this.ctx.sampleRate*0.2, buf=this.ctx.createBuffer(1,size,this.ctx.sampleRate), data=buf.getChannelData(0);
    for(let i=0;i<size;i++) data[i] = (Math.random()*2-1)*Math.exp(-i/(size*0.1));
    const src=this.ctx.createBufferSource(), gain=this.ctx.createGain(), filter=this.ctx.createBiquadFilter();
    filter.type='bandpass'; filter.frequency.value=1000; filter.Q.value=1;
    gain.gain.setValueAtTime(vel*0.6,time); gain.gain.exponentialRampToValueAtTime(0.001,time+0.2);
    src.buffer=buf; src.connect(filter).connect(gain).connect(this.masterGain); src.start(time);
  }

  playHat(time, vel) {
    const size=this.ctx.sampleRate*0.1, buf=this.ctx.createBuffer(1,size,this.ctx.sampleRate), data=buf.getChannelData(0);
    for(let i=0;i<size;i++) data[i] = (Math.random()*2-1)*Math.exp(-i/(size*0.02));
    const src=this.ctx.createBufferSource(), gain=this.ctx.createGain(), filter=this.ctx.createBiquadFilter(), panner=this.ctx.createStereoPanner();
    filter.type='highpass'; filter.frequency.value=8000; panner.pan.value=(this.pos.x-50)/100;
    gain.gain.setValueAtTime(vel*0.3,time); gain.gain.exponentialRampToValueAtTime(0.001,time+0.1);
    src.buffer=buf; src.connect(filter).connect(gain).connect(panner).connect(this.masterGain); src.start(time);
  }

  playChord(time) {
    const chord=this.chords[this.chordIndex], panner=this.ctx.createStereoPanner();
    panner.pan.value=(this.pos.x-50)/100;
    chord.forEach(freq=>{
      const osc=this.ctx.createOscillator(), gain=this.ctx.createGain(), filter=this.ctx.createBiquadFilter();
      osc.type='sine'; osc.frequency.value=freq; filter.type='lowpass'; filter.frequency.value=2000;
      gain.gain.setValueAtTime(0.15,time); gain.gain.exponentialRampToValueAtTime(0.001,time+0.8);
      osc.connect(filter).connect(gain).connect(panner).connect(this.masterGain);
      osc.start(time); osc.stop(time+0.8);
    });
  }

  playBass(time) {
    const osc=this.ctx.createOscillator(), gain=this.ctx.createGain(), filter=this.ctx.createBiquadFilter();
    osc.type='sine'; osc.frequency.value=this.bassNotes[this.bassIndex];
    filter.type='lowpass'; filter.frequency.value=200;
    gain.gain.setValueAtTime(0.2,time); gain.gain.exponentialRampToValueAtTime(0.001,time+1);
    osc.connect(filter).connect(gain).connect(this.masterGain); osc.start(time); osc.stop(time+1);
  }

  playSpatialEffect(time) {
    const osc=this.ctx.createOscillator(), gain=this.ctx.createGain(), panner=this.ctx.createStereoPanner();
    osc.type='triangle'; osc.frequency.value=800+Math.random()*1200; panner.pan.value=Math.random()*2-1;
    gain.gain.setValueAtTime(0.05,time); gain.gain.exponentialRampToValueAtTime(0.001,time+0.3);
    osc.connect(gain).connect(panner).connect(this.masterGain); osc.start(time); osc.stop(time+0.3);
  }

  startWeatherAudio() {
    this.weatherSources.forEach(src=>{ try{src.stop()}catch{} }); this.weatherSources=[];
    if(this.weather==='rain'||this.weather==='storm') {
      const size=this.ctx.sampleRate*2, buf=this.ctx.createBuffer(1,size,this.ctx.sampleRate), data=buf.getChannelData(0);
      for(let i=0;i<size;i++) data[i] = (Math.random()*2-1)*(this.weather==='storm'?0.3:0.15);
      const noise=this.ctx.createBufferSource(), noiseGain=this.ctx.createGain();
      noise.buffer=buf; noise.loop=true; noiseGain.gain.value=this.weather==='storm'?0.2:0.1;
      noise.connect(noiseGain).connect(this.weatherGain); noise.start();
      this.weatherSources.push(noise);
    } else if(this.weather==='snow') {
      const playChime=()=>{
        const now=this.ctx.currentTime, osc=this.ctx.createOscillator(), gain=this.ctx.createGain();
        osc.type='sine'; osc.frequency.value=600;
        gain.gain.setValueAtTime(0,now); gain.gain.linearRampToValueAtTime(0.1,now+0.1);
        gain.gain.exponentialRampToValueAtTime(0.001,now+1);
        osc.connect(gain).connect(this.weatherGain); osc.start(now); osc.stop(now+1);
        setTimeout(playChime,10000+Math.random()*5000);
      };
      playChime();
    }
  }
}

document.addEventListener('DOMContentLoaded', ()=>new Gump());
  </script>
</body>
</html>
