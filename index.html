<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GUMP: Grand Unified Music Project</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html,body { height:100%; margin:0; background:#090d15; overflow:hidden; font-family: -apple-system, BlinkMacSystemFont, sans-serif;}
    .intro { position:fixed; top:0; left:0; width:100vw; height:100vh; background:radial-gradient(ellipse at 60% 50%,#181e2f 0%,#090b12 80%); display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:20; transition:opacity 1.1s;}
    .intro-title { font-size:2.6rem; font-weight:900; letter-spacing:2px; color:#e5f8ff; text-shadow:0 0 60px #7fdaff; margin-bottom:2.2rem; animation:titlePulse 2.7s ease-in-out infinite alternate;}
    .intro-author { font-size:1.18rem; color:#b3e3f9; opacity:.84; margin-bottom:2.6rem; letter-spacing:.7px;}
    .intro-btn { background:linear-gradient(85deg,#00cfff 25%,#ed9fe7 90%); color:#111; font-weight:700; font-size:1.21rem; padding:19px 52px; border-radius:40px; border:none; cursor:pointer; transition:transform 0.16s;}
    .intro-btn:active { transform:scale(0.98);}
    @keyframes titlePulse { from { text-shadow:0 0 16px #b2fff7; } to { text-shadow:0 0 68px #fff9,0 4px 20px #b4d7ff88;} }
    
    .app {position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:1;opacity:0;transition:opacity 1.3s;}
    .orb-viz { width:80vw; max-width:360px; height:80vw; max-height:360px; margin:0 auto; position:relative; top:5vh; border-radius:50%; background:radial-gradient(circle at 44% 50%,#222a44 12%,#090c16 90%); box-shadow:0 0 90px 12px #334f9655; border:2.5px solid #3e579c60; display:flex; align-items:center; justify-content:center; transition:all 3.5s ease;}
    .orb-viz.void { background:radial-gradient(circle at 50% 40%,#fff9f2 8%,#ffe4d6 25%,#f0c4ff 60%,#c4d7ff 85%,#0a0f1a 100%); box-shadow:0 0 280px 60px #fff4e688; border:4px solid #fff2e8ee; transform:scale(1.15);}
    
    .music-orb { position:absolute; width:108px; height:108px; left:50%; top:50%; transform:translate(-50%,-50%); background:radial-gradient(circle at 58% 41%,#17234a 0%,#b4cfff35 69%,#171d27 100%); border-radius:50%; box-shadow:0 0 100px #a8c8fa48; z-index:2; transition:all 4s ease; animation:orbPulse 4.8s ease-in-out infinite alternate;}
    .music-orb.void { background:radial-gradient(circle at 50% 50%,#ffffff 0%,#fff9f2 30%,#ffe4d6 60%,#f0c4ff 90%); box-shadow:0 0 500px #ffffff; transform:translate(-50%,-50%) scale(1.4);}
    
    .orb-glow { position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:320px; height:320px; border-radius:50%; z-index:1; background:radial-gradient(circle at 52% 48%,#6eacf933 1%,#bdf2ffa0 30%,#0b0f1800 98%); pointer-events:none; opacity:.81; filter:blur(6px); transition:all 4s ease;}
    .orb-glow.void { background:radial-gradient(circle at 50% 50%,#ffffff88 0%,#fff9f2cc 20%,#ffe4d6aa 40%,#f0c4ff77 70%,#ffffff00 100%); width:800px; height:800px; filter:blur(40px); transform:translate(-50%,-50%) scale(1.6);}
    
    .particle { position:absolute; width:2px; height:2px; background:#4a9fff; border-radius:50%; opacity:0; animation:float 8s infinite linear;}
    .particle.void { width:4px; height:4px; background:#ffffff; box-shadow:0 0 20px #fff;}
    .freq-bar { position:absolute; width:3px; background:linear-gradient(to top,#4a9fff,#ff6ec7); border-radius:2px; transform-origin:bottom; opacity:0.7; transition:all 0.15s ease;}
    .freq-bar.void { background:linear-gradient(to top,#ffffff,#fff9f2); width:4px; opacity:0.9;}
    
    .world-label { position:absolute; left:50%; top:93%; transform:translate(-50%,-50%); background:rgba(17,24,31,0.85); color:#e5f8ff; padding:12px 30px; border-radius:30px; font-size:1.18rem; font-weight:600; opacity:0; transition:all 1.2s ease; z-index:10;}
    .world-label.show { opacity:1; transform:translate(-50%,-50%) scale(1.02);}
    .world-label.void { background:rgba(255,255,255,0.95); color:#111; font-weight:700;}
    
    .heaven-rays { position:absolute; width:100%; height:100%; top:0; left:0; pointer-events:none; z-index:0; opacity:0; transition:opacity 4s ease;}
    .heaven-rays.active { opacity:1;}
    .ray { position:absolute; width:2px; height:100vh; background:linear-gradient(to bottom,#ffffff00 0%,#ffffff88 50%,#ffffff00 100%); transform-origin:bottom; animation:rayRotate 20s linear infinite;}
    
    @keyframes float { 0%{opacity:0;transform:translateY(20px);} 10%{opacity:1;} 90%{opacity:1;} 100%{opacity:0;transform:translateY(-300px);} }
    @keyframes rayRotate { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }
    @keyframes orbPulse {from{opacity:.79;}to{opacity:.96;}}
    
    @media (max-width:500px) {
      .intro-title{font-size:1.8rem;}
      .world-label{font-size:1rem;}
      .orb-viz{top:2vh;}
    }
  </style>
</head>
<body>
  <div class="intro" id="intro">
    <div class="intro-title">GUMP: Grand Unified Music Project</div>
    <div class="intro-author">By James McCandless</div>
    <button class="intro-btn" onclick="startGUMP()">Begin</button>
  </div>
  
  <div class="app" id="app">
    <div class="orb-viz" id="orbViz">
      <div id="particles"></div>
      <div class="heaven-rays" id="heavenRays"></div>
      <div class="orb-glow" id="orbGlow"></div>
      <div class="music-orb" id="orb"></div>
      <div id="musicVis" style="position:absolute;width:200px;height:200px;left:50%;top:50%;transform:translate(-50%,-50%);z-index:3;pointer-events:none;"></div>
      <div class="world-label" id="worldLabel"></div>
    </div>
  </div>

  <script>
    let ctx, mainGain, analyser, dataArray, voidMode = false, voidDepth = 0, motionIntensity = 0;
    let stillnessTime = 0, lastMove = 0, voidTransition = 0, voidChoir;
    let musicLayers = [], elements = {};
    
    const scale = [261.63, 293.66, 329.63, 349.23, 392.00, 440.00, 493.88];
    const weatherMap = {
      "Clear": { freq: 0, type: "sine", filter: 3000 },
      "Cloudy": { freq: 2, type: "triangle", filter: 1200 },
      "Rain": { freq: 4, type: "sawtooth", filter: 600 },
      "Fog": { freq: 1, type: "sine", filter: 800 },
      "Snow": { freq: 6, type: "triangle", filter: 1500 }
    };
    
    window.onload = () => {
      elements = {
        orb: document.getElementById('orb'),
        orbViz: document.getElementById('orbViz'),
        orbGlow: document.getElementById('orbGlow'),
        label: document.getElementById('worldLabel'),
        musicVis: document.getElementById('musicVis'),
        heavenRays: document.getElementById('heavenRays'),
        particles: document.getElementById('particles')
      };
      
      // Create particles
      for(let i = 0; i < 20; i++) {
        let p = document.createElement('div');
        p.className = 'particle';
        p.style.cssText = `left:${Math.random()*100}%;animation-delay:${Math.random()*8}s;animation-duration:${6+Math.random()*4}s`;
        elements.particles.appendChild(p);
      }
      
      // Create heaven rays
      for(let i = 0; i < 8; i++) {
        let ray = document.createElement('div');
        ray.className = 'ray';
        ray.style.cssText = `left:50%;bottom:0;transform:rotate(${i*45}deg);animation-delay:${i*2}s`;
        elements.heavenRays.appendChild(ray);
      }
      
      // Create frequency bars
      for(let i = 0; i < 16; i++) {
        let bar = document.createElement('div');
        bar.className = 'freq-bar';
        bar.style.cssText = `left:${i*12}px;bottom:0;height:0`;
        elements.musicVis.appendChild(bar);
      }
    };
    
    function getNote(index, octave = 4) {
      return scale[index % 7] * Math.pow(2, octave - 4);
    }
    
    function createFilter(type, freq, q = 1) {
      let filter = ctx.createBiquadFilter();
      filter.type = type;
      filter.frequency.value = freq;
      filter.Q.value = q;
      return filter;
    }
    
    function createLayer(freq, type, filterFreq, gain = 0.1) {
      let osc = ctx.createOscillator();
      let gainNode = ctx.createGain();
      let filter = createFilter("lowpass", filterFreq);
      
      osc.type = type;
      osc.frequency.value = freq;
      gainNode.gain.value = 0;
      gainNode.gain.linearRampToValueAtTime(gain, ctx.currentTime + 1);
      
      osc.connect(filter).connect(gainNode).connect(mainGain);
      osc.start();
      
      return { osc, gain: gainNode, filter };
    }
    
    function showLabel(msg, time = 1400) {
      elements.label.textContent = msg;
      elements.label.classList.add('show');
      if(time) setTimeout(() => elements.label.classList.remove('show'), time);
    }
    
    function fadeElement(el, opacity, duration = 1000) {
      el.style.transition = `opacity ${duration}ms`;
      el.style.opacity = opacity;
    }
    
    async function startGUMP() {
      fadeElement(document.getElementById('intro'), 0, 800);
      
      setTimeout(async () => {
        document.getElementById('intro').style.display = 'none';
        document.getElementById('app').style.opacity = 1;
        
        // Initialize audio context
        ctx = new (window.AudioContext || window.webkitAudioContext)();
        await ctx.resume();
        
        mainGain = ctx.createGain();
        mainGain.gain.value = 0.6;
        mainGain.connect(ctx.destination);
        
        analyser = ctx.createAnalyser();
        analyser.fftSize = 256;
        dataArray = new Uint8Array(analyser.frequencyBinCount);
        mainGain.connect(analyser);
        
        // Request motion permissions
        if(window.DeviceMotionEvent?.requestPermission) {
          try { await DeviceMotionEvent.requestPermission(); } catch(e) {}
        }
        
        initializeMusic();
      }, 800);
    }
    
    function initializeMusic() {
      let dt = new Date();
      let weather = Object.keys(weatherMap)[Math.floor(Math.random() * 5)];
      let hour = dt.getHours();
      let isNight = hour < 7 || hour > 20;
      
      // Initialize music layers
      let weatherConfig = weatherMap[weather];
      let weatherLayer = createLayer(getNote(weatherConfig.freq), weatherConfig.type, weatherConfig.filter, 0.08);
      let bassLayer = createLayer(getNote(0, 2), isNight ? "triangle" : "sawtooth", 300, isNight ? 0.15 : 0.12);
      
      musicLayers = [weatherLayer, bassLayer];
      
      let steps = [
        "Syncing Reality Frequency…",
        "Calibrating Temporal Harmonics…", 
        "Loading Weekend Algorithms…",
        "Establishing Quantum Position…"
      ];
      
      let i = 0;
      function nextStep() {
        if(i < steps.length) {
          showLabel(steps[i], 1000);
          elements.orb.style.transform = `translate(-50%,-50%) scale(${1 + 0.05 * i})`;
          setTimeout(nextStep, 1000);
          i++;
        } else {
          showLabel("Consciousness Matrix Active", 2000);
          startRealTimeMusic();
        }
      }
      
      setTimeout(nextStep, 500);
    }
    
    function updateVisuals() {
      if(!analyser) return;
      
      analyser.getByteFrequencyData(dataArray);
      let bars = document.querySelectorAll('.freq-bar');
      
      bars.forEach((bar, i) => {
        let val = dataArray[i * 8] || 0;
        let height = (val / 255 * 80) * (1 + voidDepth);
        bar.style.height = height + 'px';
        bar.classList.toggle('void', voidMode);
      });
      
      // Update particles
      document.querySelectorAll('.particle').forEach(p => {
        p.classList.toggle('void', voidMode);
      });
    }
    
    function startRealTimeMusic() {
      setInterval(updateVisuals, 50);
      
      window.addEventListener('devicemotion', e => {
        let acc = e.accelerationIncludingGravity;
        if(!acc) return;
        
        let magnitude = Math.sqrt(acc.x*acc.x + acc.y*acc.y + acc.z*acc.z);
        motionIntensity = Math.min(magnitude / 15, 1);
        let now = performance.now();
        
        if(magnitude > 5) {
          lastMove = now;
          stillnessTime = 0;
        } else {
          stillnessTime = now - lastMove;
        }
        
        // Update void transition
        voidTransition = stillnessTime > 1000 ? Math.min((stillnessTime - 1000) / 3000, 1) : Math.max(voidTransition - 0.03, 0);
        voidDepth = voidTransition * 0.7;
        
        // Update music layers
        musicLayers.forEach(layer => {
          if(layer.gain) {
            layer.gain.gain.setTargetAtTime(0.05 + motionIntensity * 0.1, ctx.currentTime, 0.1);
          }
        });
        
        // Update visuals
        elements.orb.style.opacity = 0.7 + motionIntensity * 0.3;
        elements.orb.style.transform = `translate(-50%,-50%) scale(${1 + motionIntensity * 0.2})`;
      });
      
      // Void mode management
      setInterval(() => {
        let shouldBeVoid = voidTransition > 0.4;
        
        if(shouldBeVoid !== voidMode) {
          voidMode = shouldBeVoid;
          
          ['orbViz', 'orb', 'orbGlow', 'label', 'heavenRays'].forEach(key => {
            elements[key].classList.toggle(key === 'heavenRays' ? 'active' : 'void', voidMode);
          });
          
          if(voidMode) {
            showLabel("Ascending to Pure Consciousness...", 3000);
            // Create void choir
            voidChoir = createLayer(getNote(0, 3), "sine", 1000, 0.2);
          } else {
            showLabel("Returning to Reality", 1500);
            if(voidChoir) {
              voidChoir.osc.stop();
              voidChoir = null;
            }
          }
        }
        
        // Update void choir intensity
        if(voidMode && voidChoir) {
          voidChoir.gain.gain.setTargetAtTime(0.1 + voidDepth * 0.3, ctx.currentTime, 0.5);
        }
      }, 300);
    }
  </script>
</body>
</html>
