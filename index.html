<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GUMP: Grand Unified Music Platform</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
  <style>
    body { margin:0; padding:0; overflow:hidden; background:#000814; cursor:none; font-family:'Courier New', monospace; color:#00d4ff; height:100vh; }
    .universe { position:fixed; inset:0; z-index:-1; }
    .particle { position:absolute; width:2px; height:2px; background:#00d4ff; border-radius:50%; animation:float linear infinite; }
    @keyframes float { 0%{transform:translateY(100vh);opacity:0;}10%{opacity:1;}90%{opacity:1;}100%{transform:translateY(-20px);opacity:0;} }
    .consciousness { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center; }
    .soul-title { font-size:clamp(2rem,8vw,6rem); background:linear-gradient(45deg,#00d4ff,#ff006e,#8338ec,#00d4ff); background-size:300% 300%; -webkit-background-clip:text; -webkit-text-fill-color:transparent; animation:soulPulse 4s infinite,colorShift 8s infinite; }
    @keyframes soulPulse{0%,100%{transform:scale(1);}50%{transform:scale(1.05);}}
    @keyframes colorShift{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}
    .awakening-btn { margin-top:1rem; padding:1rem 2rem; border:2px solid #00d4ff; border-radius:50px; background:transparent; color:#00d4ff; font-size:1.2rem; text-transform:uppercase; letter-spacing:2px; cursor:pointer; position:relative; overflow:hidden; backdrop-filter:blur(10px); }
    .awakening-btn::before { content:''; position:absolute; top:0; left:-100%; width:100%; height:100%; background:rgba(255,255,255,0.1); transition:left .5s; }
    .awakening-btn:hover::before { left:100%; }
    .permission-modal { position:fixed; inset:0; background:rgba(0,0,0,0.8); display:flex; align-items:center; justify-content:center; visibility:hidden; }
    .permission-modal.visible { visibility:visible; }
    .permission-content { background:rgba(0,20,40,0.9); padding:2rem; border:2px solid #00d4ff; border-radius:20px; text-align:center; backdrop-filter:blur(10px); }
    #neuralNetwork, #frequencyViz { opacity:0; transition:opacity .5s; }
    #neuralNetwork.active, #frequencyViz.active { opacity:1; }
  </style>
</head>
<body>
  <div class="universe" id="universe"></div>
  <div class="consciousness">
    <h1 class="soul-title">GUMP</h1>
    <div style="font-size:1.2rem;color:#8338ec;letter-spacing:1px;">Grand Unified Music Platform</div>
    <button class="awakening-btn" id="awakenBtn">AWAKEN THE MUSIC</button>
  </div>
  <div class="permission-modal" id="permissionModal">
    <div class="permission-content">
      <h3>üéµ Unleash GUMP</h3>
      <p>We need motion sensor access to generate music. Tap ‚ÄúAllow‚Äù to continue.</p>
      <button class="awakening-btn" id="allowBtn">Allow Motion Access</button>
    </div>
  </div>
  <div id="neuralNetwork"></div>
  <div id="frequencyViz"></div>

  <script>
    class GumpSymphony {
      constructor() {
        this.history = [];
        this.smooth = 0;
        this.step = 0;
        this.soulState = 'sleeping';
        this.init();
      }

      init() {
        this.spawnParticles();
        this.bindUI();
        this.setupViz();
        requestAnimationFrame(() => this.animate());
      }

      spawnParticles() {
        const u = document.getElementById('universe');
        for (let i = 0; i < 100; i++) {
          const p = document.createElement('div');
          p.className = 'particle';
          p.style.left = `${Math.random() * 100}vw`;
          p.style.animationDuration = `${15 + Math.random() * 10}s`;
          p.style.animationDelay = `${Math.random() * 20}s`;
          u.appendChild(p);
        }
      }

      bindUI() {
        document.getElementById('awakenBtn').onclick = () => this.onAwaken();
        document.getElementById('allowBtn').onclick = () => this.onAllow();
      }

      async onAwaken() {
        await Tone.start();
        if (Tone.context.state !== 'running') await Tone.context.resume();
        document.querySelector('.consciousness').style.display = 'none';
        document.getElementById('permissionModal').classList.add('visible');
        await this.setupAudio();
      }

      async onAllow() {
        document.getElementById('permissionModal').classList.remove('visible');
        try {
          const perm = await DeviceMotionEvent.requestPermission();
          if (perm === 'granted') this.enableAccel();
          else return;
        } catch {
          return;
        }

        this.start();
      }

      enableAccel() {
        window.addEventListener('devicemotion', (e) => {
          const a = e.accelerationIncludingGravity || {};
          const motion = Math.max(0, Math.hypot(a.x||0, a.y||0, a.z||0) - 9.8);
          this.track(motion);
        });
      }

      track(v) {
        this.history.push(v);
        if (this.history.length > 8) this.history.shift();
        const avg = this.history.reduce((sum, val) => sum + val, 0) / this.history.length;
        this.smooth = this.smooth * 0.7 + avg * 0.3;
        this.updateState();
      }

      updateState() {
        const i = this.smooth / 100;
        this.soulState = i < 0.05 ? 'meditating'
                        : i < 0.2 ? 'breathing'
                        : i < 0.4 ? 'dancing'
                        : i < 0.7 ? 'flowing'
                        : 'transcending';
      }

      async setupAudio() {
        this.heart = new Tone.MonoSynth({
          oscillator: { type: 'sine' },
          envelope: { attack: 0.1, decay: 0.8, sustain: 0.2, release: 1 }
        }).toDestination();
        Tone.Transport.bpm.value = 120;
      }

      start() {
        Tone.Transport.start();
        document.getElementById('neuralNetwork').classList.add('active');
        document.getElementById('frequencyViz').classList.add('active');
        Tone.Transport.scheduleRepeat((time) => this.tick(time), '16n');
      }

      tick(time) {
        const intensity = this.smooth / 100;
        if (intensity > 0.1) {
          this.heart.triggerAttackRelease('C2', '8n', time, intensity);
        }
      }

      setupViz() {
        const viz = document.getElementById('frequencyViz');
        for (let i = 0; i < 64; i++) {
          const bar = document.createElement('div');
          bar.className = 'freq-bar';
          bar.style.height = '2px';
          viz.appendChild(bar);
        }
      }

      animate() {
        if (Tone.Transport.state === 'started') {
          // update viz here based on this.smooth
        }
        requestAnimationFrame(() => this.animate());
      }
    }

    document.addEventListener('DOMContentLoaded', () => new GumpSymphony());
  </script>
</body>
</html>
