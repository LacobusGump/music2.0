<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GUMP: Grand Unified Music Project</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <style>
    html,body {height:100%;margin:0;padding:0;overflow:hidden;background:#0b0f18;}
    body {font-family:-apple-system,BlinkMacSystemFont,sans-serif;}
    .intro {
      position:fixed;top:0;left:0;width:100vw;height:100vh;
      background:radial-gradient(ellipse at 60% 50%,#181e2f 0%,#090b12 80%);
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      z-index:20;transition:opacity 1.3s;
    }
    .intro-title {
      font-size:2.5rem;font-weight:900;letter-spacing:2px;
      color:#e5f8ff;text-shadow:0 0 60px #7fdaff,0 4px 16px #000b;
      margin-bottom:2.3rem;opacity:.95;
      animation:introFade 2.7s cubic-bezier(.9,0,.1,1) alternate infinite;
    }
    .intro-author {
      font-size:1.2rem;color:#b3e3f9;opacity:.82;margin-bottom:2.7rem;letter-spacing:.9px;
    }
    .intro-btn {
      background:linear-gradient(85deg,#00cfff 25%,#ed9fe7 90%);
      color:#111;font-weight:700;font-size:1.22rem;padding:20px 55px;
      border-radius:40px;border:none;cursor:pointer;box-shadow:0 0 36px #59d4fd22;
      letter-spacing:1px;
      transition:transform 0.18s;
    }
    .intro-btn:active {transform:scale(0.98);}
    @keyframes introFade {
      from { text-shadow:0 0 16px #b2fff7; }
      to { text-shadow:0 0 68px #fff9,0 4px 20px #b4d7ff88;}
    }

    .app {position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:1;opacity:0;transition:opacity 1.3s;}
    .hidden {display:none!important;}
    .viz {
      width:85vw;max-width:410px;height:85vw;max-height:410px;
      margin:0 auto;position:relative;top:2vh;
      border-radius:50%;background:radial-gradient(circle at 44% 50%,#262c4c 10%,#090c16 90%);
      box-shadow:0 0 80px 20px #334f965a,0 0 140px #02122eaa inset;
      border:3px solid #40579c80;
      display:flex;align-items:center;justify-content:center;
    }
    .viz.void {
      background:radial-gradient(circle at 50% 54%,#fff2ee 4%,#ecc4e7 28%,#c1c4fd 90%);
      border-color:#e5caf9;
      box-shadow:0 0 240px #edbcff33,0 0 120px #fff9 inset;
      transition:all 1.5s;
    }
    .music-orb {
      position:absolute;width:120px;height:120px;left:50%;top:50%;
      transform:translate(-50%,-50%);
      background:radial-gradient(circle at 57% 41%,#17234a 0%,#b4cfff44 68%,#171d27 100%);
      border-radius:50%;
      box-shadow:0 0 120px #a8c8fa60,0 0 44px #b9fff8a0;
      transition:background .7s,box-shadow 1.2s;
      z-index:2;
    }
    .music-orb.void {
      background:radial-gradient(circle at 55% 41%,#f1cfff 0%,#fcf9fc 95%);
      box-shadow:0 0 170px #ffcfff55,0 0 90px #fff9;
    }
    .orb-glow {
      position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
      width:320px;height:320px;border-radius:50%;z-index:1;
      background:radial-gradient(circle at 52% 48%,#6eacf933 1%,#bdf2ffa0 30%,#0b0f1800 95%);
      pointer-events:none;mix-blend-mode:lighten;opacity:.85;
      filter:blur(6px);animation:orbPulse 4.8s cubic-bezier(.65,0,.35,1) infinite alternate;
    }
    .viz.void .orb-glow {
      background:radial-gradient(circle at 51% 50%,#ffeaff 12%,#e9d0ff 44%,#f7feff10 98%);
      opacity:.98;filter:blur(8px);
    }
    @keyframes orbPulse {from{opacity:.82;}to{opacity:.97;}}
    /* Vibe dial */
    .dial-wrap {position:fixed;right:8vw;bottom:8vh;width:160px;height:160px;z-index:40;}
    @media (max-width:650px){.dial-wrap{right:2vw;bottom:2vh;width:31vw;height:31vw;min-width:100px;min-height:100px;}}
    .dial-bg {width:100%;height:100%;border-radius:50%;background:radial-gradient(ellipse at 55% 45%,#232b47 20%,#1a102a 100%);border:3px solid #75b0ff77;}
    .dial-dot {
      position:absolute;width:38px;height:38px;left:50%;top:50%;
      transform:translate(-50%,-50%);border-radius:50%;
      background:linear-gradient(100deg,#e3faff,#ffbae3 70%);
      box-shadow:0 0 24px #f4caff99,0 0 44px #6deaff55;
      transition:box-shadow .12s,background .22s;
      cursor:grab;touch-action:none;z-index:2;
    }
    .dial-label {position:absolute;font-size:1.09em;color:#bfe2ff;font-weight:700;opacity:.82;text-shadow:0 1px 12px #000a;}
    .label-tl {top:11px;left:23px;}
    .label-tr {top:11px;right:18px;}
    .label-bl {bottom:16px;left:18px;}
    .label-br {bottom:16px;right:23px;}
    .label-mid {top:50%;left:50%;transform:translate(-50%,-50%);font-size:1.09em;color:#fff8;text-shadow:0 0 20px #b4f7;}
    /* Error */
    .error {background:#221a;border-radius:15px;padding:18px 32px;color:#ff6b6b;z-index:100;}
  </style>
</head>
<body>
  <!-- Intro -->
  <div class="intro" id="intro">
    <div class="intro-title">GUMP: Grand Unified Music Project</div>
    <div class="intro-author">By: James McCandless</div>
    <button class="intro-btn" id="introBtn">Begin</button>
  </div>
  <!-- Main app -->
  <div class="app" id="app">
    <div class="viz" id="viz">
      <div class="orb-glow" id="orbGlow"></div>
      <div class="music-orb" id="musicOrb"></div>
    </div>
    <!-- Vibe dial -->
    <div class="dial-wrap" id="dialWrap">
      <div class="dial-bg"></div>
      <div class="dial-dot" id="dialDot"></div>
      <span class="dial-label label-tl">90s<br>Hip Hop</span>
      <span class="dial-label label-tr">Classical</span>
      <span class="dial-label label-bl">Latin</span>
      <span class="dial-label label-br">Country</span>
      <span class="dial-label label-mid">Vibe</span>
    </div>
    <div class="error hidden" id="error"></div>
  </div>
  <script>
    // Fade intro -> main app
    const intro = document.getElementById('intro'), app = document.getElementById('app');
    document.getElementById('introBtn').onclick = function() {
      intro.style.opacity = 0;
      setTimeout(()=>{ intro.style.display = 'none'; app.style.opacity = 1; }, 1100);
    };

    // --- VIBE SPHERE DIAL ---
    const dialWrap = document.getElementById('dialWrap'), dialDot = document.getElementById('dialDot');
    let dialState = { x: 0.5, y: 0.5 }; // normalized XY
    let dragging = false;
    function updateDot() {
      dialDot.style.left = (dialState.x * 100) + '%';
      dialDot.style.top  = (dialState.y * 100) + '%';
    }
    dialWrap.addEventListener('pointerdown', e=>{
      dragging = true; moveDial(e);
    });
    window.addEventListener('pointerup', ()=>{ dragging=false; });
    dialWrap.addEventListener('pointermove', e=>{
      if(dragging) moveDial(e);
    });
    function moveDial(e) {
      let rect = dialWrap.getBoundingClientRect();
      let cx = e.touches?e.touches[0].clientX:e.clientX;
      let cy = e.touches?e.touches[0].clientY:e.clientY;
      let x = (cx - rect.left)/rect.width, y = (cy - rect.top)/rect.height;
      let dx = x-0.5, dy = y-0.5, dist = Math.sqrt(dx*dx+dy*dy);
      if(dist>0.5) { dx/=dist*2; dy/=dist*2; x=0.5+dx; y=0.5+dy; }
      dialState.x = Math.max(0,Math.min(1,x));
      dialState.y = Math.max(0,Math.min(1,y));
      updateDot();
    }
    updateDot();

    // --- GUMP MUSIC ENGINE ---
    class GUMP {
      constructor() {
        this.ctx = null; this.reverb = null;
        this.motion = 0; this.motionWindow = [];
        this.last = {x:0,y:0,z:0}; this.lastMotionTime = Date.now();
        this.hasMoved = false; this.introStep = 0;
        this.chordStep = 0; this.tick = 0;
        this.state = 'void';
        this.vibe = { x:0.5, y:0.5 }; // "tuning"
        this.dropTimer = 0; this.section = 'build'; // song structure state
        this.cool = {hip:0,classical:0,latin:0,country:0};
        this.init();
      }
      init() {
        setInterval(()=>{ this.vibe.x=dialState.x; this.vibe.y=dialState.y; },50);
        document.getElementById('musicOrb').onclick = ()=>{ /*easteregg*/ };
        this.startBtn = this.createStartBtn();
      }
      createStartBtn() {
        let btn = document.createElement('button');
        btn.className='intro-btn'; btn.textContent='Start Music';
        btn.style.position='absolute';btn.style.left='50%';btn.style.top='50%';
        btn.style.transform='translate(-50%,-50%)';
        btn.onclick = () => this.start();
        app.appendChild(btn);
        return btn;
      }
      createReverb() {
        this.reverb = this.ctx.createConvolver();
        let b = this.ctx.createBuffer(2, this.ctx.sampleRate*3, this.ctx.sampleRate);
        for (let c=0;c<2;c++) {
          let d = b.getChannelData(c);
          for (let i=0;i<d.length;i++) d[i] = (Math.random()*2-1)*Math.pow(1-i/d.length,3.4);
        }
        this.reverb.buffer = b; this.reverb.connect(this.ctx.destination);
      }
      async start() {
        try {
          if (typeof DeviceMotionEvent?.requestPermission === 'function') {
            const perm = await DeviceMotionEvent.requestPermission();
            if (perm !== 'granted') throw new Error('Permission denied');
          }
          this.ctx = new (window.AudioContext || window.webkitAudioContext)();
          await this.ctx.resume(); this.createReverb();
          this.startBtn.classList.add('hidden');
          this.active = true;
          this.startSensors(); this.masterClock(); this.animate();
        } catch (e) {
          this.showError('Motion sensors unavailable. Please use a mobile device.');
        }
      }
      startSensors() {
        window.addEventListener('devicemotion', e => {
          if (!this.active) return;
          const acc = e.accelerationIncludingGravity;
          if (!acc || acc.x === null) return;
          const dx = acc.x - this.last.x, dy = acc.y - this.last.y, dz = acc.z - this.last.z;
          let power = Math.sqrt(dx*dx + dy*dy + dz*dz);
          this.last = {x: acc.x, y: acc.y, z: acc.z};
          this.motionWindow.push(power); if (this.motionWindow.length>8) this.motionWindow.shift();
          this.motion = this.motionWindow.reduce((a,b)=>a+b,0)/this.motionWindow.length;
          if (this.motion > 0.7) {
            this.lastMotionTime = Date.now();
            if (!this.hasMoved) { this.hasMoved = true; this.introStep = 1; this.section = 'build'; this.dropTimer=0;}
          }
        });
      }
      animate() {
        const update = () => {
          if (!this.active) return;
          let orb=document.getElementById('musicOrb'), viz=document.getElementById('viz'), inVoid=this.state==='void';
          orb.className = 'music-orb'+(inVoid?' void':'');
          viz.className = 'viz'+(inVoid?' void':'');
          document.getElementById('orbGlow').style.opacity = inVoid ? '1' : '0.87';
          requestAnimationFrame(update);
        }; update();
      }
      masterClock() {
        setInterval(() => {
          if (!this.active) return;
          this.updateState();
          if (!this.hasMoved) return;
          // --- Section logic ---
          if (this.state==='void') {
            this.voidEngine();
            this.dropTimer=0; this.section='build';
          } else {
            if (this.section==='build') {
              if (this.dropTimer<16*6) { // 6 bars build
                this.drumsEngine(this.drumPreset('kick'));
                if (this.tick===15) this.dropTimer++;
                if (this.dropTimer>16*2) this.mainVibe(this.vibeBlend(),true); // bring in pad/bass
                if (this.dropTimer>=16*6) { this.section='drop'; this.dropTick=0; }
              }
            } else if (this.section==='drop') {
              this.drumsEngine(this.drumPreset('full'));
              this.mainVibe(this.vibeBlend(),false,true); // big
              if (this.tick===15) { this.dropTick=(this.dropTick||0)+1; }
              if (this.dropTick>12) { this.section='build'; this.dropTimer=0; }
            }
          }
          this.tick = (this.tick+1)%16;
          if (this.tick===0) { this.chordStep=(this.chordStep+1)%4; }
        }, 250); // 120bpm 8th
      }
      updateState() {
        const now = Date.now();
        this.state = ((now-this.lastMotionTime)<1600)?'dark':'void';
      }
      // ---- ARTISTIC MUSIC ENGINE ----
      // 4 corners: HipHop, Classical, Latin, Country
      // genreCrossfade returns 4 blend values
      genreCrossfade(x,y) {
        // Smooth corners
        let tl=(1-x)*(1-y), tr=x*(1-y), bl=(1-x)*y, br=x*y;
        let norm = tl+tr+bl+br; if (norm===0) norm=1;
        return {
          hip:tl/norm, classical:tr/norm, latin:bl/norm, country:br/norm
        };
      }
      vibeBlend() {
        let {x,y}=this.vibe;
        let g = this.genreCrossfade(x,y);
        // "Round" the mix for more distinct feel
        let max = Math.max(g.hip,g.classical,g.latin,g.country);
        let boost = v=>v===max?0.92:0.31;
        // Let edges be more defined, mid more mixed
        let edgeFade = 0.7+0.22*(1-Math.abs(x-0.5))*0.7*(1-Math.abs(y-0.5));
        return {
          hip: Math.pow(g.hip,edgeFade)*boost(g.hip),
          classical: Math.pow(g.classical,edgeFade)*boost(g.classical),
          latin: Math.pow(g.latin,edgeFade)*boost(g.latin),
          country: Math.pow(g.country,edgeFade)*boost(g.country)
        };
      }
      drumPreset(mode='kick') {
        if (mode==='kick') return {kick:1,snare:0,hat:0,perc:0};
        if (mode==='full') return {kick:1,snare:1,hat:1,perc:1};
      }
      drumsEngine({kick=1,snare=1,hat=1,perc=1}) {
        let v=this.vibeBlend();
        let dark=0.4+0.9*v.hip-0.16*v.latin+0.08*v.country-0.1*v.classical;
        let now=this.ctx.currentTime;
        // - Kick (HipHop dark or acoustic), with sidechain to pads
        if (kick&&this.tick%4===0) {
          let o=this.ctx.createOscillator(),g=this.ctx.createGain();
          o.type = v.hip>0.53?'sine':'triangle';
          o.frequency.setValueAtTime(43,now);
          o.frequency.exponentialRampToValueAtTime(15+dark*20,now+0.16+v.latin*0.06);
          g.gain.setValueAtTime(0.35+0.22*dark,now);
          g.gain.exponentialRampToValueAtTime(0.001,now+0.3);
          o.connect(g).connect(this.reverb); o.start(now); o.stop(now+0.32+dark*0.09);
        }
        // - Snare
        if (snare&&this.tick%8===4) {
          let b=this.ctx.createBuffer(1,this.ctx.sampleRate*0.13,this.ctx.sampleRate),d=b.getChannelData(0);
          for(let i=0;i<d.length;i++)d[i]=Math.random()*2-1;
          let n=this.ctx.createBufferSource(); n.buffer=b;
          let f=this.ctx.createBiquadFilter(); f.type='highpass'; f.frequency.value=1100+v.classical*700;
          let g=this.ctx.createGain(); g.gain.setValueAtTime(0.19+0.08*v.hip,now);
          g.gain.exponentialRampToValueAtTime(0.001,now+0.12+v.latin*0.06);
          n.connect(f).connect(g).connect(this.reverb); n.start(now); n.stop(now+0.14+v.classical*0.07);
        }
        // - Hat
        if (hat&&this.tick%2===0) {
          let b=this.ctx.createBuffer(1,this.ctx.sampleRate*0.048,this.ctx.sampleRate),d=b.getChannelData(0);
          for(let i=0;i<d.length;i++)d[i]=Math.random()*2-1;
          let n=this.ctx.createBufferSource(); n.buffer=b;
          let f=this.ctx.createBiquadFilter(); f.type='highpass'; f.frequency.value=4800+v.latin*1300;
          let g=this.ctx.createGain(); g.gain.setValueAtTime(0.023+v.classical*0.03,now);
          g.gain.exponentialRampToValueAtTime(0.001,now+0.07);
          n.connect(f).connect(g).connect(this.reverb); n.start(now); n.stop(now+0.06+v.latin*0.04);
        }
        // - Perc/clave, syncopation for latin/country
        if (perc&&this.tick%8===2&&v.latin>0.13) {
          let o=this.ctx.createOscillator(),g=this.ctx.createGain();
          o.type='square';o.frequency.value=590+v.country*70;
          g.gain.setValueAtTime(0.09+0.07*v.latin,now);
          g.gain.exponentialRampToValueAtTime(0.001,now+0.04+v.country*0.04);
          o.connect(g).connect(this.reverb); o.start(now); o.stop(now+0.05+v.latin*0.06);
        }
      }
      mainVibe({hip,classical,latin,country},fade=1,drop=0) {
        // Chord voicings per genre
        let chords = [
          [0,2,4],   // A minor (hiphop pad, modal)
          [0,2,5],   // C maj7 (classical string, hiphop lead)
          [2,5,7],   // Dm sus9 (latin style)
          [0,4,7],   // A major (country/folk)
        ];
        let chord = chords[this.chordStep];
        // --- PAD ---
        if (this.tick%8===0||drop) this.pad(chord,fade,hip,classical,latin,country);
        // --- BASS ---
        if (this.tick%4===2||drop) this.bass(chord[0],fade,hip,classical,latin,country);
      }
      pad(chord,amt=1,hip=0.4,classical=0.2,latin=0.2,country=0.3) {
        let now=this.ctx.currentTime;
        chord.forEach((deg,i)=>{
          let base=[130.8,155.6,196,220,261.6,293.66,329.63,392][deg%8];
          let freq = base*(1+(i-1)*0.09+hip*0.18+classical*0.06+latin*0.09-country*0.04);
          let o=this.ctx.createOscillator(),g=this.ctx.createGain();
          o.type=classical>0.33?'triangle':hip>0.37?'sawtooth':latin>0.37?'square':country>0.37?'sine':'triangle';
          o.frequency.value=freq;
          o.detune.value=(Math.random()-0.5)*8+classical*9-hip*8+latin*11-country*8;
          g.gain.setValueAtTime(0.027*amt,now);
          g.gain.linearRampToValueAtTime(0.15*amt,now+1.0+0.13*i);
          g.gain.linearRampToValueAtTime(0.001,now+2.7+0.13*i);
          o.connect(g).connect(this.reverb);
          o.start(now+0.06*i); o.stop(now+2.8+0.13*i);
        });
      }
      bass(degree,amt=1,hip=0.4,classical=0.2,latin=0.2,country=0.3) {
        let now=this.ctx.currentTime;
        let freq=[45,52,65,72][this.chordStep%4]*(1+0.35*classical+0.15*latin);
        let o=this.ctx.createOscillator(),g=this.ctx.createGain();
        o.type = latin>0.4?'triangle':country>0.4?'square':hip>0.5?'sine':'triangle';
        o.frequency.value=freq; o.detune.value=hip*21-classical*9+latin*8-country*7;
        g.gain.setValueAtTime(0.13*amt,now);
        g.gain.exponentialRampToValueAtTime(0.001,now+0.44+classical*0.13+country*0.1);
        o.connect(g).connect(this.reverb); o.start(now); o.stop(now+0.48+classical*0.18);
      }
      // ---- VOID/HEAVEN ENGINE ----
      voidEngine() {
        let chord=[0,4,7]; // major, peaceful
        let posInBar=this.tick%16;
        if (posInBar===0||posInBar===8) this.floatPad(chord);
        if (posInBar===7&&Math.random()<0.53) this.voidBell();
        if (posInBar===13&&Math.random()<0.22) this.angelic();
      }
      floatPad(chord) {
        let now=this.ctx.currentTime;
        chord.forEach((deg,i)=>{
          let base=[130.8,155.6,196,220,261.6,293.66,329.63,392][deg%8];
          let freq = base*0.72;
          let o=this.ctx.createOscillator(),g=this.ctx.createGain();
          o.type='sine'; o.frequency.value=freq;
          g.gain.setValueAtTime(0.12,now);
          g.gain.linearRampToValueAtTime(0.17,now+1.7+0.17*i);
          g.gain.linearRampToValueAtTime(0.001,now+3.2+0.18*i);
          o.connect(g).connect(this.reverb);
          o.start(now+0.09*i); o.stop(now+3.45+0.12*i);
        });
      }
      voidBell() {
        let o=this.ctx.createOscillator(),g=this.ctx.createGain();
        o.type='triangle'; o.frequency.value=311+Math.random()*41;
        g.gain.setValueAtTime(0.09,this.ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.001,this.ctx.currentTime+3.1+Math.random());
        o.connect(g).connect(this.reverb);
        o.start(); o.stop(this.ctx.currentTime+3.1+Math.random());
      }
      angelic() {
        let o=this.ctx.createOscillator(),g=this.ctx.createGain();
        o.type='sine'; o.frequency.value=812+Math.random()*92;
        g.gain.setValueAtTime(0.06,this.ctx.currentTime);
        g.gain.linearRampToValueAtTime(0.001,this.ctx.currentTime+2.1);
        o.connect(g).connect(this.reverb);
        o.start(); o.stop(this.ctx.currentTime+1.7);
      }
      showError(msg) {
        let e=document.getElementById('error');
        e.textContent=msg; e.classList.remove('hidden');
      }
    }
    new GUMP();
  </script>
</body>
</html>
