<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GUMP: Grand Unified Music Project</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html,body {height:100%;margin:0;background:#0a0e14;}
    body {overflow:hidden;}
    .intro,.error,.app {position:fixed;top:0;left:0;width:100vw;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;}
    .intro {z-index:10;background:#0a0e14;}
    .intro-title {font-size:2.1rem;font-weight:800;color:#d8fdff;letter-spacing:1.5px;margin-bottom:2.1rem;text-shadow:0 0 22px #7fdaff;}
    .intro-author {font-size:1.1rem;color:#acecff;opacity:.76;margin-bottom:2.3rem;letter-spacing:.7px;}
    .intro-btn {background:linear-gradient(80deg,#2eeaff,#a9c6ff 80%);color:#161b22;font-weight:700;font-size:1.25rem;padding:19px 60px;border-radius:40px;border:none;cursor:pointer;box-shadow:0 0 32px #00ffaa22;}
    .app {z-index:1;opacity:0;transition:opacity 1.3s;}
    .viz {width:320px;height:320px;border-radius:38px;background:rgba(20,20,32,0.12);border:3px solid #3e507c;box-shadow:0 0 60px #39428022;position:relative;}
    .viz.void {border-color:#cfd0fd;box-shadow:0 0 140px #9fc3ff44;}
    .orb {position:absolute;width:110px;height:110px;border-radius:50%;background:radial-gradient(circle,#191f2f 0%,#5d8afe22 90%,transparent 100%);top:50%;left:50%;transform:translate(-50%,-50%);}
    .orb.void {background:radial-gradient(circle,#fff9e5 0%,#e5aaff 45%,transparent 100%);}
    .pulse {animation:pulse 1.14s cubic-bezier(.85,0,.32,1) alternate infinite;}
    @keyframes pulse {from{transform:translate(-50%,-50%) scale(1);}to{transform:translate(-50%,-50%) scale(1.10);}}
    .start-btn {position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-size:1.2rem;padding:18px 45px;border-radius:30px;background:linear-gradient(45deg,#1e304b,#a3ffd7);color:#000;border:none;font-weight:700;cursor:pointer;z-index:10;box-shadow:0 4px 22px #00ffaa22;}
    .hidden {display:none!important;}
    .error {background:#221a;border-radius:15px;padding:18px 32px;color:#ff6b6b;z-index:100;}
    .vibe-dial {position:fixed;right:12vw;bottom:7vh;width:170px;height:170px;z-index:20;}
    @media (max-width:600px){ .vibe-dial{right:4vw;bottom:4vh;width:33vw;height:33vw;min-width:110px;min-height:110px;}}
    .dial-bg {width:100%;height:100%;border-radius:50%;background:radial-gradient(ellipse at 45% 50%,#33395f 20%,#060a14 100%);border:2.7px solid #597fbe88;}
    .dial-dot {position:absolute;width:34px;height:34px;left:50%;top:50%;transform:translate(-50%,-50%);border-radius:50%;background:linear-gradient(120deg,#9ed7f7,#8cfcce);box-shadow:0 0 18px #c8f5ff88,0 0 35px #191a32aa;}
    .dial-label {position:absolute;font-size:0.98em;color:#93bad7;font-weight:700;opacity:.85;text-shadow:0 1px 10px #000b;}
    .label-tl {top:10px;left:20px;}
    .label-tr {top:10px;right:18px;}
    .label-bl {bottom:12px;left:14px;}
    .label-br {bottom:12px;right:16px;}
    .label-mid {top:50%;left:50%;transform:translate(-50%,-50%);font-size:1em;color:#dfedff;}
  </style>
</head>
<body>
  <div class="intro" id="intro">
    <div class="intro-title">GUMP: Grand Unified Music Project</div>
    <div class="intro-author">By: James McCandless</div>
    <button class="intro-btn" id="introBtn">Begin</button>
  </div>
  <div class="app">
    <div class="viz" id="viz"><div class="orb" id="orb"></div></div>
    <button class="start-btn" id="start">Start</button>
    <div class="vibe-dial" id="dial">
      <div class="dial-bg"></div>
      <div class="dial-dot" id="dialDot"></div>
      <span class="dial-label label-tl">90s<br>Hip Hop</span>
      <span class="dial-label label-tr">Classical</span>
      <span class="dial-label label-bl">Latin</span>
      <span class="dial-label label-br">Country</span>
      <span class="dial-label label-mid">Vibe</span>
    </div>
    <div class="error hidden" id="error"></div>
  </div>
  <script>
    // --- UI logic for fade in, intro, etc ---
    document.querySelector('.app').style.opacity = 0;
    document.getElementById('introBtn').onclick = function() {
      let intro = document.getElementById('intro');
      intro.style.opacity = 0;
      setTimeout(()=>{ intro.style.display = 'none'; }, 900);
      setTimeout(()=>{ document.querySelector('.app').style.opacity = 1; }, 300);
    };

    // --- Vibe Sphere Dial logic ---
    let dial = document.getElementById('dial'), dot = document.getElementById('dialDot');
    let dialState = { x: 0.5, y: 0.5 }; // center (0-1)
    let dragging = false;
    function updateDot() {
      dot.style.left = (dialState.x * 100) + '%';
      dot.style.top  = (dialState.y * 100) + '%';
    }
    dial.addEventListener('pointerdown', function(e){
      dragging=true; moveDial(e);
    });
    window.addEventListener('pointerup', ()=>{ dragging=false; });
    dial.addEventListener('pointermove', function(e){
      if(dragging) moveDial(e);
    });
    function moveDial(e) {
      let rect = dial.getBoundingClientRect();
      let cx = e.touches?e.touches[0].clientX:e.clientX;
      let cy = e.touches?e.touches[0].clientY:e.clientY;
      let x = (cx - rect.left)/rect.width, y = (cy - rect.top)/rect.height;
      let dx = x-0.5, dy = y-0.5, dist = Math.sqrt(dx*dx+dy*dy);
      if(dist>0.5) { dx/=dist*2; dy/=dist*2; x=0.5+dx; y=0.5+dy; }
      dialState.x = Math.max(0,Math.min(1,x));
      dialState.y = Math.max(0,Math.min(1,y));
      updateDot();
    }
    updateDot();

    // --- MUSIC ENGINE (adapted from last GUMP core) ---
    class GUMP {
      constructor() {
        this.ctx = null; this.reverb = null;
        this.motion = 0; this.motionWindow = [];
        this.last = {x:0,y:0,z:0}; this.lastMotionTime = Date.now();
        this.hasMoved = false; this.introStep = 0;
        this.chordStep = 0; this.tick = 0;
        this.state = 'void';
        this.vibe = { x:0.5, y:0.5 }; // "tuning"
        this.init();
      }
      init() {
        document.getElementById('start').onclick = () => this.start();
        // Tie dial to music
        setInterval(()=>{
          this.vibe.x = dialState.x;
          this.vibe.y = dialState.y;
        },60);
      }
      createReverb() {
        this.reverb = this.ctx.createConvolver();
        let b = this.ctx.createBuffer(2, this.ctx.sampleRate*3, this.ctx.sampleRate);
        for (let c=0;c<2;c++) {
          let d = b.getChannelData(c);
          for (let i=0;i<d.length;i++) d[i] = (Math.random()*2-1)*Math.pow(1-i/d.length,3.6);
        }
        this.reverb.buffer = b; this.reverb.connect(this.ctx.destination);
      }
      async start() {
        try {
          if (typeof DeviceMotionEvent?.requestPermission === 'function') {
            const perm = await DeviceMotionEvent.requestPermission();
            if (perm !== 'granted') throw new Error('Permission denied');
          }
          this.ctx = new (window.AudioContext || window.webkitAudioContext)();
          await this.ctx.resume(); this.createReverb();
          document.getElementById('start').classList.add('hidden');
          this.active = true;
          this.startSensors(); this.masterClock(); this.animate();
        } catch (e) {
          this.showError('Motion sensors unavailable. Please use a mobile device.');
        }
      }
      startSensors() {
        window.addEventListener('devicemotion', e => {
          if (!this.active) return;
          const acc = e.accelerationIncludingGravity;
          if (!acc || acc.x === null) return;
          const dx = acc.x - this.last.x, dy = acc.y - this.last.y, dz = acc.z - this.last.z;
          let power = Math.sqrt(dx*dx + dy*dy + dz*dz);
          this.last = {x: acc.x, y: acc.y, z: acc.z};
          this.motionWindow.push(power); if (this.motionWindow.length>8) this.motionWindow.shift();
          this.motion = this.motionWindow.reduce((a,b)=>a+b,0)/this.motionWindow.length;
          if (this.motion > 0.7) {
            this.lastMotionTime = Date.now();
            if (!this.hasMoved) { this.hasMoved = true; this.introStep = 1; }
          }
        });
      }
      animate() {
        const update = () => {
          if (!this.active) return;
          let orb=document.getElementById('orb'), viz=document.getElementById('viz'), inVoid=this.state==='void';
          orb.className = 'orb'+(inVoid?' void pulse':' pulse');
          viz.className = 'viz'+(inVoid?' void':'');
          document.body.className = inVoid?'void':'';
          requestAnimationFrame(update);
        }; update();
      }
      masterClock() {
        setInterval(() => {
          if (!this.active) return;
          this.updateState();
          if (!this.hasMoved) return;
          if (this.state==='dark') {
            if (this.introStep===1) { // bar 1: Kick only, fade up gain
              this.drumsEngine(this.drumPreset('kick'));
              if (this.tick===15) { this.introStep=2; }
            }
            else if (this.introStep===2) { // bar 2: Snare/hat fade in
              this.drumsEngine(this.drumPreset('snare'));
              if (this.tick===15) { this.introStep=3; }
            }
            else { // bar 3+: Full groove
              this.drumsEngine(this.drumPreset('full'));
              this.mainVibe(this.vibeBlend());
            }
          } else { // VOID
            this.voidEngine();
          }
          this.tick = (this.tick+1)%16;
          if (this.tick===0) { this.chordStep=(this.chordStep+1)%4; }
        }, 250); // 120bpm 8ths
      }
      updateState() {
        const now = Date.now();
        this.state = ((now-this.lastMotionTime)<1400)?'dark':'void';
      }
      // ---- MUSIC ENGINE ----
      // VIBE BLEND: 4 corners (tl,tr,bl,br), crossfaded by X/Y.
      vibeBlend() {
        // Corners: tl=hiphop tr=classical bl=latin br=country, center is average
        let x=this.vibe.x, y=this.vibe.y;
        // --- Drum ---
        // Hip hop: heavy kick/snare, less hat. Classical: rim/click, Latin: clave/hats, Country: shuffle.
        // --- Harmony ---
        // Hip hop: minor 7 pads, Classical: full chords, Latin: sus9, Country: triad + pedal
        // --- Bass ---
        // Hip hop: sub short, Classical: low sustained, Latin: percussive, Country: simple pluck.
        // For prototype, we just crossfade "sound" and pattern weight
        return {
          fade: 1,
          egg: 0,
          hiphop: (1-x)*(1-y),
          classical: x*(1-y),
          latin: (1-x)*y,
          country: x*y
        };
      }
      drumPreset(phase) {
        let v = this.vibeBlend();
        let amt = (phase=='kick'?0.7:(phase=='snare'?0.6:1));
        // Blend drum "styles" by vibe
        let kick = amt*(v.hiphop*1.1 + v.classical*0.8 + v.latin*0.6 + v.country*0.7);
        let snare = amt*(v.hiphop*1.2 + v.classical*0.4 + v.latin*0.8 + v.country*1.1);
        let hat = amt*(v.hiphop*0.5 + v.classical*0.9 + v.latin*1.1 + v.country*1.0);
        return {kick:kick>0.4,snare:snare>0.4,hat:hat>0.2,amt:amt};
      }
      drumsEngine({kick=true,snare=true,hat=true,amt=1}) {
        let posInBar=this.tick%16;
        if (kick&&(posInBar===0||posInBar===8)) this.softKick(amt);
        if (snare&&posInBar===4) this.softSnare(amt);
        if (hat&&posInBar%2===1) this.softHat(amt*0.88);
      }
      softKick(amt=1) {
        let now=this.ctx.currentTime;
        let o=this.ctx.createOscillator(),g=this.ctx.createGain();
        o.type='sine'; o.frequency.setValueAtTime(43,now);
        o.frequency.exponentialRampToValueAtTime(17,now+0.22);
        g.gain.setValueAtTime(0.5*amt,now);
        g.gain.exponentialRampToValueAtTime(0.001,now+0.37);
        o.connect(g).connect(this.reverb); o.start(now); o.stop(now+0.4);
      }
      softSnare(amt=1) {
        let now=this.ctx.currentTime;
        let b=this.ctx.createBuffer(1,this.ctx.sampleRate*0.15,this.ctx.sampleRate);
        let d=b.getChannelData(0); for(let i=0;i<d.length;i++)d[i]=(Math.random()*2-1)*(1-i/d.length);
        let n=this.ctx.createBufferSource(); n.buffer=b;
        let f=this.ctx.createBiquadFilter(); f.type='highpass'; f.frequency.value=1200;
        let g=this.ctx.createGain(); g.gain.setValueAtTime(0.17*amt,now);
        g.gain.exponentialRampToValueAtTime(0.001,now+0.12);
        n.connect(f).connect(g).connect(this.reverb); n.start(now); n.stop(now+0.14);
      }
      softHat(amt=1) {
        let now=this.ctx.currentTime;
        let b=this.ctx.createBuffer(1,this.ctx.sampleRate*0.038,this.ctx.sampleRate);
        let d=b.getChannelData(0); for(let i=0;i<d.length;i++)d[i]=Math.random()*2-1;
        let n=this.ctx.createBufferSource(); n.buffer=b;
        let f=this.ctx.createBiquadFilter(); f.type='highpass'; f.frequency.value=5400;
        let g=this.ctx.createGain(); g.gain.setValueAtTime(0.016*amt,now);
        g.gain.exponentialRampToValueAtTime(0.001,now+0.04);
        n.connect(f).connect(g).connect(this.reverb); n.start(now); n.stop(now+0.05);
      }
      mainVibe({fade=1,egg=0,hiphop=0.3,classical=0.2,latin=0.2,country=0.3}) {
        // Chord: morph between genre voicings, simple for now
        let chord = [
          // [hiphop, classical, latin, country]
          [0,2,4],   // A minor (hiphop pad, modal)
          [0,2,5],   // C maj7 (classical string, hiphop lead)
          [2,5,7],   // Dm sus9 (latin style)
          [0,4,7],   // A major (country/folk)
        ][this.chordStep];
        // Blend synth voice based on dial
        let posInBar = this.tick%16;
        if (posInBar===0||posInBar===8) this.pad(chord,fade,hiphop,classical,latin,country);
        if (posInBar===2||posInBar===10) this.bass(chord[0],fade,hiphop,classical,latin,country);
      }
      bass(degree,amt=1,hh=0.4,cl=0.3,la=0.2,co=0.3) {
        let now=this.ctx.currentTime;
        let freq=[45,52,65,72][this.chordStep%4]*(1+0.35*cl+0.15*la);
        let o=this.ctx.createOscillator(),g=this.ctx.createGain();
        o.type = la>0.4?'triangle':co>0.4?'square':hh>0.5?'sine':'triangle';
        o.frequency.value=freq; o.detune.value=hh*22-cl*8+la*7-co*5;
        g.gain.setValueAtTime(0.13*amt,now);
        g.gain.exponentialRampToValueAtTime(0.001,now+0.36+cl*0.16+co*0.1);
        o.connect(g).connect(this.reverb); o.start(now); o.stop(now+0.4+cl*0.18);
      }
      pad(chord,amt=1,hh=0.3,cl=0.3,la=0.2,co=0.2) {
        let now=this.ctx.currentTime;
        chord.forEach((deg,i)=>{
          let base=[130.8,155.6,196,220,261.6,293.66,329.63,392][deg%8];
          let freq = base*(1+(i-1)*0.09+hh*0.1+cl*0.04+la*0.05-co*0.04);
          let o=this.ctx.createOscillator(),g=this.ctx.createGain();
          o.type=cl>0.35?'triangle':hh>0.44?'sawtooth':la>0.4?'square':co>0.3?'sine':'triangle';
          o.frequency.value=freq;
          o.detune.value=(Math.random()-0.5)*7+cl*11-hh*6+la*8-co*5;
          g.gain.setValueAtTime(0.03*amt,now);
          g.gain.linearRampToValueAtTime(0.13*amt,now+0.9+0.12*i);
          g.gain.linearRampToValueAtTime(0.001,now+2.2+0.11*i);
          o.connect(g).connect(this.reverb);
          o.start(now+0.08*i); o.stop(now+2.3+0.12*i);
        });
      }
      voidEngine() {
        let chord=[0,4,7]; // major, peaceful
        let posInBar=this.tick%16;
        if (posInBar===0||posInBar===8) this.floatPad(chord);
        if (posInBar===7&&Math.random()<0.53) this.voidBell();
        if (posInBar===13&&Math.random()<0.2) this.angelic();
      }
      floatPad(chord) {
        let now=this.ctx.currentTime;
        chord.forEach((deg,i)=>{
          let base=[130.8,155.6,196,220,261.6,293.66,329.63,392][deg%8];
          let freq = base*0.73;
          let o=this.ctx.createOscillator(),g=this.ctx.createGain();
          o.type='sine'; o.frequency.value=freq;
          g.gain.setValueAtTime(0.12,now);
          g.gain.linearRampToValueAtTime(0.15,now+1.5+0.18*i);
          g.gain.linearRampToValueAtTime(0.001,now+3.4+0.28*i);
          o.connect(g).connect(this.reverb);
          o.start(now+0.13*i); o.stop(now+3.7+0.17*i);
        });
      }
      voidBell() {
        let o=this.ctx.createOscillator(),g=this.ctx.createGain();
        o.type='triangle'; o.frequency.value=311+Math.random()*71;
        g.gain.setValueAtTime(0.09,this.ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.001,this.ctx.currentTime+3.1+Math.random());
        o.connect(g).connect(this.reverb);
        o.start(); o.stop(this.ctx.currentTime+3.1+Math.random());
      }
      angelic() {
        let o=this.ctx.createOscillator(),g=this.ctx.createGain();
        o.type='sine'; o.frequency.value=812+Math.random()*102;
        g.gain.setValueAtTime(0.06,this.ctx.currentTime);
        g.gain.linearRampToValueAtTime(0.001,this.ctx.currentTime+2.1);
        o.connect(g).connect(this.reverb);
        o.start(); o.stop(this.ctx.currentTime+1.7);
      }
      showError(msg) {
        let e=document.getElementById('error');
        e.textContent=msg; e.classList.remove('hidden');
      }
    }
    new GUMP();
  </script>
</body>
</html>
