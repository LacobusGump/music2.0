<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GUMP: Grand Unified Music Project</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html,body{height:100%;margin:0;background:#0a0c11;}
    .intro{position:fixed;top:0;left:0;width:100vw;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#161826;z-index:10;transition:opacity .9s;}
    .intro-title{font-size:2.2rem;font-weight:900;color:#e5f8ff;text-shadow:0 0 32px #7fdaff;}
    .intro-author{font-size:1.1rem;color:#b3e3f9;opacity:.85;margin-bottom:2.6rem;}
    .intro-btn{background:linear-gradient(85deg,#00cfff 25%,#ed9fe7 90%);color:#111;font-weight:700;font-size:1.14rem;padding:18px 45px;border-radius:40px;border:none;cursor:pointer;box-shadow:0 0 36px #59d4fd22;}
    .intro-btn:active { transform:scale(0.98);}
    .app {position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:1;opacity:0;transition:opacity 1.3s;}
    .orb-viz {width:80vw; max-width:350px; height:80vw; max-height:350px; margin:0 auto; position:relative; top:7vh; border-radius:50%; background:radial-gradient(circle at 44% 50%,#222a44 12%,#0a0c11 90%); box-shadow:0 0 90px 12px #334f9655,0 0 130px #02122e88 inset; border:2.5px solid #3e579c60; display:flex; align-items:center; justify-content:center;}
    .music-orb {position:absolute; width:106px; height:106px; left:50%; top:50%; transform:translate(-50%,-50%); background:radial-gradient(circle at 50% 45%,#15132a 0%,#b4cfff28 69%,#171d27 100%); border-radius:50%; box-shadow:0 0 100px #a8c8fa32,0 0 32px #b9fff842; z-index:2; transition:background .9s,box-shadow 1.1s;}
    .music-orb.void {background:radial-gradient(circle at 48% 52%,#0e0c14 10%,#281e3b 55%,#18101c 100%); box-shadow:0 0 160px #a36ce255, 0 0 90px #22124599;}
    .orb-glow {position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:300px; height:300px; border-radius:50%; z-index:1; background:radial-gradient(circle at 52% 48%,#4250b933 1%,#bdf2ff40 36%,#0b0f1800 98%); pointer-events:none; mix-blend-mode:lighten; opacity:.65; filter:blur(9px);}
    .world-label {position:absolute; left:50%; top:92%; transform:translate(-50%,-50%); background:rgba(17,24,31,0.85); color:#e5f8ff; padding:12px 30px; border-radius:30px; font-size:1.12rem; letter-spacing:.6px; font-weight:600; opacity:0; pointer-events:none; box-shadow:0 8px 30px #0b0f1b36; transition:opacity 0.7s; z-index:10; text-align:center;}
    .world-label.show { opacity:1;}
  </style>
</head>
<body>
  <div class="intro" id="intro">
    <div class="intro-title">GUMP: Grand Unified Music Project</div>
    <div class="intro-author">By James McCandless</div>
    <button class="intro-btn" id="begin">Begin</button>
    <div id="permMsg" style="color:#ff6b6b; font-size:1rem; margin-top:22px; display:none;"></div>
  </div>
  <div class="app" id="app">
    <div class="orb-viz">
      <div class="orb-glow"></div>
      <div class="music-orb" id="orb"></div>
      <div class="world-label" id="worldLabel"></div>
    </div>
  </div>
  <script>
    // Permission logic and fallback UI
    const intro = document.getElementById('intro');
    const app = document.getElementById('app');
    const beginBtn = document.getElementById('begin');
    const permMsg = document.getElementById('permMsg');
    let ctx, unlocked=false, allowMotion=false;

    beginBtn.onclick = async () => {
      beginBtn.disabled = true;
      permMsg.style.display = "none";
      // --- AUDIO UNLOCK ---
      try {
        ctx = new (window.AudioContext || window.webkitAudioContext)();
        await ctx.resume();
        // Extra user gesture for iOS
        let unlockOsc = ctx.createOscillator();
        unlockOsc.connect(ctx.destination);
        unlockOsc.start();
        unlockOsc.stop(ctx.currentTime+0.03);
        unlocked = true;
      } catch (e) {
        permMsg.textContent = "Could not unlock audio. Tap again or try another browser.";
        permMsg.style.display = "block";
        beginBtn.disabled = false;
        return;
      }
      // --- MOTION PERMISSION ---
      if (window.DeviceMotionEvent && typeof DeviceMotionEvent.requestPermission === "function") {
        try {
          let resp = await DeviceMotionEvent.requestPermission();
          if (resp !== "granted") throw "denied";
          allowMotion = true;
        } catch (e) {
          permMsg.textContent = "Motion permission denied. Enable in Settings > Safari > Privacy > Motion & Orientation Access.";
          permMsg.style.display = "block";
          beginBtn.disabled = false;
          return;
        }
      } else {
        allowMotion = true;
      }
      // --- FADE INTRO, START APP ---
      intro.style.opacity = 0;
      setTimeout(() => {
        intro.style.display = "none";
        app.style.opacity = 1;
        startGUMP();
      }, 900);
    };

    // --- INSERT YOUR ENGINE CODE HERE ---
    // For demo, a working "pulse" sound based on movement, all features
    function startGUMP() {
      // All your weather/geo/music code goes hereâ€”keep as before
      // For now, this shows the orb responding to motion & plays sound for proof
      let orb = document.getElementById('orb');
      let lastMove = 0, moving = false, lastPulse = 0;
      let gain = ctx.createGain(); gain.gain.value = 0.65; gain.connect(ctx.destination);

      // Dummy main loop for proof
      setInterval(() => {
        let t = performance.now();
        // Pulse every 500ms when moving
        if (moving && t - lastPulse > 500) {
          let o = ctx.createOscillator();
          o.type = "sine";
          o.frequency.setValueAtTime(42, ctx.currentTime);
          o.frequency.linearRampToValueAtTime(27, ctx.currentTime + 0.22);
          let g = ctx.createGain();
          g.gain.value = 0.33;
          o.connect(g).connect(gain);
          o.start();
          o.stop(ctx.currentTime + 0.22);
          g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.22);
          lastPulse = t;
        }
        orb.style.boxShadow = moving ? "0 0 120px #6cf,0 0 80px #fff6" : "0 0 40px #444";
      }, 60);

      // Real movement, no fake
      window.addEventListener('devicemotion', e => {
        if (!allowMotion) return;
        let acc = e.accelerationIncludingGravity;
        if (!acc) return;
        let lv = Math.sqrt(acc.x * acc.x + acc.y * acc.y + acc.z * acc.z);
        moving = lv > 13;
        if (moving) lastMove = performance.now();
      });
    }
  </script>
</body>
</html>
